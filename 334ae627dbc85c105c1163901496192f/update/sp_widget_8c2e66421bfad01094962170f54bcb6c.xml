<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function() {
	/* widget controller */
	var c = this;

	c.selected = false;

	c.selectStars = function(index){
		if(index === c.selected){
			for(var i in c.data.stars){
				c.data.stars[i] = false;
			}
			c.selected = false;
		}
		else{
			c.selected = index;
			for(var i in c.data.stars){
				if(i <= index){
					c.data.stars[i] = true;
				}
				else{
					c.data.stars[i] = false
				}
			}
		}
	}
	
	c.sendSurvey = function(){
		c.data.action = "sendSurvey";
		c.data.stars = parseInt(c.selected) + 1;
		c.server.update();
	}

}]]></client_script>
        <controller_as>c</controller_as>
        <css>.content {
  background-color: white;
  padding: 50px 90px;

  .modal {
    .modal-header {
      .modal-title {
        font-family: $text-bold;
        text-transform: uppercase;
        color: $blue;
      }
      .close {
        position: absolute;
        top: 15px;
        right: 15px;
      }
    }

    .modal-body {
      padding: 20px;

      .description {
        margin-bottom: 30px;
      }
      .question1 {
        display: flex;
        justify-content: center;
        margin-bottom: 30px;

        .fa-star {
          transition: .2s ease-in-out;
          color: #ccc;
          font-size: 48px;
          margin: 0px 8px;

          &amp;:hover {
            transform: scale(1.2);
          }
        }
        .active-star {
          color: #FEDB6D;
        }
      }
      .question2 {
        .label_text {
          font-family: $text-bold;
        }
        textarea {
          min-width: 100%;
          max-width: 100%;
          width: 100%;
          min-height: 80px;

        }
      }
    }
  }
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>gservice_survey_csc</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>GService Survey CSC</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	/* populate the 'data' object */
	/* e.g., data.table = $sp.getValue('table'); */
	var localInput = input;

	if(!localInput){
		data.stars = [false, false, false, false];
		data.feedback = "";
		//GERA SURVEY
	}
	else{
		switch(localInput.action){
			case "sendSurvey":
				var grInstance = new GlideRecord("asmt_assessment_instance");
				grInstance.get("df430fce1b3ed01094962170f54bcb45");

				var grQuestion = new GlideRecord("asmt_assessment_instance_question");
				grQuestion.addQuery("instance", grInstance.getUniqueValue());
				grQuestion.query();
				while(grQuestion.next()){
					if(grQuestion.metric.datatype == "string"){
						grQuestion.setValue("string_value", localInput.feedback);
					}
					else{
						grQuestion.setValue("value", localInput.stars);
					}
					grQuestion.update();
				}
				grInstance.setValue("state", "complete");
				grInstance.setValue("taken_on", new GlideDateTime().getDisplayValue());
				grInstance.update();
				break;
			default:
				break;
		}
	}

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>organize.jorge.garcia</sys_created_by>
        <sys_created_on>2020-08-24 17:51:05</sys_created_on>
        <sys_id>8c2e66421bfad01094962170f54bcb6c</sys_id>
        <sys_mod_count>72</sys_mod_count>
        <sys_name>GService Survey CSC</sys_name>
        <sys_package display_value="ITSM Service Portal" source="x_gmeps_itsm_servi">334ae627dbc85c105c1163901496192f</sys_package>
        <sys_policy/>
        <sys_scope display_value="ITSM Service Portal">334ae627dbc85c105c1163901496192f</sys_scope>
        <sys_update_name>sp_widget_8c2e66421bfad01094962170f54bcb6c</sys_update_name>
        <sys_updated_by>organize.fernando</sys_updated_by>
        <sys_updated_on>2020-08-24 19:50:17</sys_updated_on>
        <template><![CDATA[<div class="content">

  <!-- Button trigger modal -->
  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
    Launch Survey Modal
  </button>

  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">

        <div class="modal-header">
          <h3 class="modal-title" id="exampleModalLabel">Survey title</h3>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <div class="description">
            Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s.
          </div>
          <div class="question1">
            <i ng-repeat="star in data.stars track by $index" class="fa fa-star" ng-class="star ? 'active-star' : ''" ng-click="c.selectStars($index)"></i>
          </div>
          <div class="question2">
            <div class="label_text">Leave us a feedback</div>
            <textarea ng-model="data.feedback"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" ng-click="c.sendSurvey()">Send Survey</button>
        </div>
      </div>
    </div>
  </div>

</div>]]></template>
    </sp_widget>
</record_update>
