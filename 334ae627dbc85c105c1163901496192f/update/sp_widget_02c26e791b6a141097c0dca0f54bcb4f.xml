<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function ($scope, $timeout, spUtil, $location) {
	var c = this;

	c.contentOpened = false;
	c.is_ie = navigator.userAgent.indexOf("MSIE ") > -1 || navigator.userAgent.indexOf("Trident/") > -1; 

	$scope.$on('refreshNotificationList', function(event, notificationID) {
		c.server.get({
			action: "refreshNotificationList",
			notificationWidget : c.data.notificationWidget,
			notificationID : notificationID
		}).then(function(response) {
			c.data.notificationWidget = response.data.notificationWidget;
			c.data.showEmptyMessage = true;
			for(var i in c.data.notificationWidget){
				if(c.data.notificationWidget[i].show){
					c.data.showEmptyMessage = false;
				}
			}

			$timeout(function(){
				for(var i in c.data.notificationWidget){
					var newLeft = c.data.left * c.data.notificationWidget[i].position;
					c.makeTransition(i, newLeft);
				}
			}, 200);
			$('#pendingResponse').modal("show");
		});
	});

	c.back = function(){
		if(!c.disableControl){
			for(var i in c.data.notificationWidget){
				c.data.notificationWidget[i].position++;
				if(c.data.notificationWidget[i].position > c.data.notificationWidget.length - 1){
					c.change_z_index(i, 0);
					c.data.notificationWidget[i].position = 0;
				}
				var newLeft = c.data.left * c.data.notificationWidget[i].position;
				c.makeTransition(i, newLeft);
			}
			c.disableControl = true;
			$timeout(function(){
				c.disableControl = false;
				for(var i in c.data.notificationWidget){
					c.change_z_index(i, 50);
				}
			}, 500);
		}
	}

	c.next = function(){
		if(!c.disableControl){
			for(var i in c.data.notificationWidget){
				c.data.notificationWidget[i].position--;
				if(c.data.notificationWidget[i].position < 0){
					c.change_z_index(i, 0);
					c.data.notificationWidget[i].position = c.data.notificationWidget.length -1;
				}
				var newLeft = c.data.left * c.data.notificationWidget[i].position;
				c.makeTransition(i, newLeft);
			}
			c.disableControl = true;
			$timeout(function(){
				c.disableControl = false;
				for(var i in c.data.notificationWidget){
					c.change_z_index(i, 50);
				}
			}, 500);
		}
	}
}]]></client_script>
        <controller_as>c</controller_as>
        <css>.content_notification {
  background-color: white;
  margin-bottom: 15px;

  .title_category {
    transition: .2s ease-in-out;
    color: $deep-sky-blue;
    text-transform: uppercase;
    font-size: 22px;
    padding: 30px 90px;
    padding-bottom: 25px;

    .invert-arrow {
      transition: .8s ease-in-out;
      transform: rotate(180deg);
    }
    img {
      transition: .8s ease-in-out;
      margin-top: -4px;
      margin-left: 8px;
      width: 16px;
    }

    &amp;:hover {
      transition: .2s ease-in-out;
      transform: translate(0, -5px);
    }
  }
  .items_length {
    color: white;
    text-align: center;
    background-color: $coral;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    font-family: $text-bolder;
    font-size: 14px;
    display: inline-block;
    margin-left: 10px;
  }

  .content_body_mask {
    overflow: hidden;

    .content_body_ntf, .content_body_ntf_ie {
      margin-top : -2000px;
      transition: .8s ease-in-out;
    }
  }

  .header_message {
    padding: 20px 0;
    margin: 0 90px;
    font-family: $text-bold;
    font-size: 16px;
    line-height: 1;
    border-bottom: 2px solid $deep-sky-blue;
  }
}

.center {
  display: flex;
  align-items: center;
  justify-content: center;
}

.category-title {
  text-align: center;
  padding-bottom: 30px;
  font-size: 28px;
  font-family: $text-bold;
  color: $deep-sky-blue;
  background-color: white;
  text-transform: uppercase;
}

.content {
  background-color: white;
  position: relative;
  padding-bottom: 50px;

  .control {
    font-family: $text-bold;
    position: absolute;
    top: calc(50% - 35px);
    z-index: 200;
    width: 100% !important;

    .back, .next {
      transition: .2s ease-in-out;
      position: absolute;
      width: 70px;
      height: 70px;

      &amp;:hover {opacity: .75;}
      img {height: 70px;}
    }
    .back {left: 40px;}
    .next {right: 40px;}
  }

  .slide_content_mask {
    overflow: hidden;
    height: 390px;
    width: 84%;

    .slide_content {
      display: flex;
      position: relative;
    }
  }

  .item {
    transition: .5s ease-in-out;
    position: absolute;
    background-color: white;
    padding: 0 12px;

    &amp;:hover {

      img {
        transform: scale(1.1);
        -webkit-transform: scale(1.1);
        -ms-transform: scale(1.1);
        -moz-transform: scale(1.1);
        -o-transform: scale(1.1);
      }
      .title {
        transform: translateY(-10px);
        -webkit-transform: translateY(-10px);
        -ms-transform: translateY(-10px);
        -moz-transform: translateY(-10px);
        -o-transform: translateY(-10px);
      }
    }

    .item_ {
      text-align: center;
    }

    img {
      transition: .3s ease-in-out;
      height: 110px;
      margin-bottom: 15px;
    }
    .title {
      transition: .3s ease-in-out;
      font-size: 18px;
      line-height: 1.2;
      font-family: $text-bolder;
      text-transform: uppercase;
      margin-bottom: 10px;
      padding: 0 12px;
    }
    .description {
      font-size: 14px;
      font-family: $text-bold;
      line-height: 1.2;
    }
  }
}

/* Conversation Widget */
.content_notifications {
  .content_conversation {
    text-align: left;

    .form-control {
      width: 300px !important;
    }
  }
  .submit_button {
    left: 345px !important;
  }
}

.without_notification {
  padding: 30px 90px;
  font-size: 30px;
}

.modal {
  .close {
    font-size: 36px;
    font-family: $text-light;
    margin-right: 20px;
    margin-top: 15px;
  }
  .modal-body {
    padding: 60px 100px;

    .modal-title {
      color: $blue;
      font-size: 30px;
    }
    .modal-description {
      font-size: 24px;
      font-family: $text-bold;
    }
  }
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>gservice_my_dashboard_notification_v2</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
	var c = controller;

	c.openContent = function() {
		var contentBody;
		var height;

		if(c.is_ie){
			contentBody = element.find(".content_body_ntf_ie");
			var count = Math.round(c.data.notificationWidget.length / 2);
			height = count * 390;

			if(height == 0) {
				height = 176;
			}else {
				height += 154;
			}
			
		} else {
			contentBody = element.find(".content_body_ntf");
			height = contentBody.outerHeight();
		}
		c.contentOpened = !c.contentOpened;

		if(!c.contentOpened) {
			contentBody.css("margin-top", "-" + height + 'px');
		}
		else {
			contentBody.css("margin-top", 0);
		}
	}

	c.makeTransition = function(position, newLeft){
		var slide = element.find('#slide' + position);
		slide.css('left', newLeft + '%');
	}

	c.change_z_index = function(position, z_index){
		var slide = element.find('#slide' + position);
		slide.css('z-index', z_index);
	}
}]]></link>
        <name>GService My Dashboard Notification v2</name>
        <option_schema>[{"hint":"Selects the columns to show on the table","name":"table","section":"Presentation","label":"Table","type":"string"},{"name":"table_template","section":"Behavior","label":"Table Template","type":"string"}]</option_schema>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	var localInput = input; //to safeguard pullution of "input" via BR or other scripts
	var portalUtils = new global.OCLPortalUtils();
	data.showEmptyMessage = false;

	//Used to get the current user sys_id
	var userID = gs.getUser().getID();
	data.user_id = userID;

	var user_id = data.user_id;
	data.notifications = portalUtils.getNotifications(user_id);
	
	var queries = portalUtils.getNotificationQuery();

	data.notificationWidget = [];
	for(i in data.notifications){
		var gservice_ticket_notification_options = {table : data.notifications[i].table,
																								sys_id : data.notifications[i].sys_id,
																								tab : "gservice_ticket_notifications_tab"};
		var gservice_ticket_notification = $sp.getWidget('gservice_ticket_conversation', gservice_ticket_notification_options);
		var jsonWidget = {instance : gservice_ticket_notification, show : true, sys_id : data.notifications[i].sys_id};
		data.notificationWidget.push(jsonWidget);
	}
	
	if(data.notificationWidget.length == 0){
		data.showEmptyMessage = true;
	}
	else{
		data.items_number = 2;
		data.original_number = data.items_number;
		data.left = 100 / data.items_number;
		for(var i in data.notificationWidget){
			data.notificationWidget[i].position = i;
			data.notificationWidget[i].left = i * data.left;
		}
	}

	if(localInput){
		if(localInput.action == "refreshNotificationList"){
			data.notificationWidget = localInput.notificationWidget;
			for(i in data.notificationWidget){
				if(data.notificationWidget[i].sys_id == localInput.notificationID){
					data.notificationWidget.splice(i, 1);
				}
			}

			for(var i in data.notificationWidget){
				data.notificationWidget[i].position = i;
				data.notificationWidget[i].left = i * data.left;
			}
		}
	}

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>organize.jorge.garcia</sys_created_by>
        <sys_created_on>2020-08-11 12:07:09</sys_created_on>
        <sys_id>02c26e791b6a141097c0dca0f54bcb4f</sys_id>
        <sys_mod_count>84</sys_mod_count>
        <sys_name>GService My Dashboard Notification v2</sys_name>
        <sys_package display_value="ITSM Service Portal" source="x_gmeps_itsm_servi">334ae627dbc85c105c1163901496192f</sys_package>
        <sys_policy/>
        <sys_scope display_value="ITSM Service Portal">334ae627dbc85c105c1163901496192f</sys_scope>
        <sys_update_name>sp_widget_02c26e791b6a141097c0dca0f54bcb4f</sys_update_name>
        <sys_updated_by>organize.jorge.garcia</sys_updated_by>
        <sys_updated_on>2020-10-13 19:16:09</sys_updated_on>
        <template><![CDATA[<div class="content_notification">
  <div class="title_category" ng-click="c.openContent()">
    ${Notificações de Tecnologia}
    <span><img src="GService_Seta_PD_Transparent.png" ng-class="c.contentOpened ? '' : 'invert-arrow'"/></span>
    <span class="items_length">{{data.notificationWidget.length}}</span>
  </div>
  <div class="content_body_mask" ng-if="!c.is_ie">
    <div class="content_body_ntf">
      <div class="header_message">${My Dashboard Notification 1}<br>${My Dashboard Notification 2}</div>
      <div ng-if="data.notificationWidget.length == 0" ng-show="!c.isLoading" class="without_notification">
        ${GService Without Notifications}
      </div>
      <div class="content center" ng-if="data.notificationWidget.length > 0">
        <div class="control">
          <div class="back center" ng-if="data.notificationWidget.length > 2" ng-click="c.back()"><img src="GS_Carrosel_ESQ.png"/></div>
          <div class="next center" ng-if="data.notificationWidget.length > 2" ng-click="c.next()"><img src="GS_Carrosel_DIR.png"/></div>
        </div>
        <div class="slide_content_mask">
          <div class="slide_content">
            <div class="item" id="slide{{$index}}"
                 ng-repeat="widget in data.notificationWidget"
                 style="left: {{widget.left}}%; width: {{data.left}}%;"
                 ng-click="selectedCategory(widget.sys_id)">
              <div class="item_">
                <sp-widget widget="widget.instance"></sp-widget>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Just IE -->
  <div class="content_body_mask" ng-if="c.is_ie">
    <div class="content_body_ntf_ie">
      <div class="header_message">${My Dashboard Notification 1}<br>${My Dashboard Notification 2}</div>
      <div ng-if="data.notificationWidget.length == 0" ng-show="!c.isLoading" class="without_notification">
        ${GService Without Notifications}
      </div>
      <div class="content widget_notifications" ng-if='data.notificationWidget.length > 0'>
        <div class="col-md-6 border-notification" ng-repeat="widget in data.notificationWidget" ng-if="widget.show">
          <sp-widget widget="widget.instance"></sp-widget>
        </div>
      </div>
      <div class="modal fade" style="z-index: 1041" id="pendingResponse" tabindex="-1" role="dialog" aria-labelledby="articleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <div class="modal-body">
              <div class="modal-title">${Sua resposta foi enviada com sucesso!}</div>
              <div class="modal-description">${Acompanhe o andamento no Histórico da Solicitação.}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<div class="modal fade" style="z-index: 1041" id="pendingResponse" tabindex="-1" role="dialog" aria-labelledby="articleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      <div class="modal-body">
        <div class="modal-title">${Sua resposta foi enviada com sucesso!}</div>
        <div class="modal-description">${Acompanhe o andamento no Histórico da Solicitação.}</div>
      </div>
    </div>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
