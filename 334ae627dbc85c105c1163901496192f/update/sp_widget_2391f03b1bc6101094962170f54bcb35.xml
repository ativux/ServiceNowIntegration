<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($scope, spUtil) {
	var c = this;

	spUtil.recordWatch($scope, "sc_req_item", "sys_id=" + c.data.sys_id, function(event) {
		if(event.data.record.state){
			c.data.action = "stateChangedBackend";
			c.data.newState = event.data.record.state;
			c.server.update().then(function(){
			});
		}
	});
}]]></client_script>
        <controller_as>c</controller_as>
        <css>.content {
  
  .cat_item_properties{
    font-family: $text-bold;
    font-size: 18px;
  }
  
  .turn_bold{
    font-family: $text-bold;
  }
  
  .set_margin_top{
    margin-top: 20px;
  }
  
  .set_margin_bottom{
  	margin-bottom: 20px;
  }
  
  .color_change{
    color: $deep-sky-blue;
  }
  
  .pending {
    color: $coral !important;
  }
  .inProgress {
    color: $yellow-green;
  }
  .resolved {
    color: $deep-sky-blue;
  }
  
  .margin_align{
    margin-top: 20px;
  }
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>gservice_record_details</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>GService Record Details</name>
        <option_schema>[{"hint":"What is the table of the record?","name":"table","section":"Data","label":"Table","type":"string"},{"hint":"What is the sys_id of the record?","name":"sys_id","section":"Data","label":"Sys_id","type":"string"},{"hint":"Used to choose what fields to show, separated by comma (when table is not \"sc_req_item\")","name":"fields","section":"Presentation","label":"Fields","type":"string"}]</option_schema>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	var localInput = input;
	var portalUtils = new global.OCLPortalUtils();

	if(!localInput){
		data.table = options.table;
		data.sys_id = options.sys_id;
		data.fields = options.fields || "number, short_description, state";

		var grRecord = new GlideRecord(data.table);
		if(grRecord.get(data.sys_id)){

			if(grRecord.getValue("request")){
				data.parent = grRecord.getDisplayValue("request");
			} else{
				data.parent = false;
			}

			data.number = grRecord.getValue("number");

			if(grRecord.getValue("cat_item")){
				data.cat_item = grRecord.getDisplayValue("cat_item");
			} else{
				data.cat_item = false;
			}

			data.statusValue = grRecord.getValue("state");
			data.statusLabel = grRecord.getDisplayValue("state");
			data.statusColor = portalUtils.getColorClass(data.statusValue, data.table);


			data.ticketInfo = portalUtils.getTicketInfo(data.table, data.sys_id);
			data.ticketInfo.forecast = portalUtils.getForecast(data.sys_id);

		}

		var hide_new_comments = false;
		var grVariables = new GlideRecord(data.table);
		grVariables.get(data.sys_id);
		if(data.table == "sc_req_item"){
			data.variables = new global.GlobalServiceCatalogUtil().getVariablesForTask(grVariables, true);
			if(data.statusValue == "3" || data.statusValue == "4" || data.statusValue == "7" || data.statusValue == "10"){
				hide_new_comments = true;
			}
		} else{
			data.variables = $sp.getFields(grVariables, data.fields);
		}

		data.gservice_ticket_conversation_options = {table : data.table,
																								sys_id : data.sys_id,
																								item_status : data.statusColor,
																								hide_title : true,
																								hide_new_comments : hide_new_comments};
//data.ticketConversationWidget = $sp.getWidget('gservice_custom_conversation', gservice_ticket_conversation_options);
	} else{
		if(localInput.action == "stateChangedBackend"){
			var state = localInput.newState;
			data.table = localInput.table;
			data.statusValue = state.value;
			data.statusLabel = state.display_value;
			data.statusColor = portalUtils.getColorClass(data.statusValue, data.table);
		}
	}

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>organize.henrique</sys_created_by>
        <sys_created_on>2020-07-23 12:29:11</sys_created_on>
        <sys_id>2391f03b1bc6101094962170f54bcb35</sys_id>
        <sys_mod_count>59</sys_mod_count>
        <sys_name>GService Record Details</sys_name>
        <sys_package display_value="ITSM Service Portal" source="x_gmeps_itsm_servi">334ae627dbc85c105c1163901496192f</sys_package>
        <sys_policy/>
        <sys_scope display_value="ITSM Service Portal">334ae627dbc85c105c1163901496192f</sys_scope>
        <sys_update_name>sp_widget_2391f03b1bc6101094962170f54bcb35</sys_update_name>
        <sys_updated_by>organize.henrique</sys_updated_by>
        <sys_updated_on>2020-08-01 15:45:26</sys_updated_on>
        <template><![CDATA[<div class="content">
  <div ng-if="data.parent"><span>${Request} #{{data.parent}}</span></div>
  <div><span>#{{data.number}}</span></div>
  <div ng-if="data.cat_item">
    <span class="cat_item_properties">{{data.cat_item}}</span>
  </div>
  <div class="turn_bold set_margin_top set_margin_bottom set_margin">
    <span class="{{data.statusColor}}">${Status}: {{data.statusLabel}}</span>
  </div>
  <div>
    <div class="turn_bold color_change">${Data de Abertura}: {{data.ticketInfo.openedAt}}</div>
    <div class="turn_bold color_change">${Forecast}: {{data.ticketInfo.forecast}}</div>
    <div class="set_margin_bottom"><span class="turn_bold">${Resumo da solicitação}: </span>{{data.ticketInfo.summary}}</div>
    <span ng-if="data.table == 'sc_req_item'">
      <div class="turn_bold color_change">${Detalhes da solicitação}:</div>
      <div ng-repeat="variable in data.variables">
        <span class="turn_bold">{{variable.label}} : </span>{{variable.display_value}}
      </div>
    </span>
  </div>
  <div class="margin_align">
    <widget id="gservice_custom_conversation" options='data.gservice_ticket_conversation_options'></widget>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
