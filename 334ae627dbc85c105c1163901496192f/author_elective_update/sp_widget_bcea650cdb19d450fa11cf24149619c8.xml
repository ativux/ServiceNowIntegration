<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="DELETE">
        <category>custom</category>
        <client_script><![CDATA[function ($scope, $http, nowServer, $timeout, spUtil, spScUtil, spModal, i18n, $window, $location, spAriaUtil, nowAttachmentHandler, $log, $sce, $q, spAtf, spSCNavStateManager, cabrillo) {
	var c = this;
	$scope.guide_step = 0;
	$scope.m = $scope.data.msgs;
	$scope.evaluatingIncludes = false;
	$scope.data.isMEE = cabrillo.isNative() && $scope.options.native_mobile == 'true';
	$scope.isItemOpened = false;
	var webAnalyticsMsgSuffix = $scope.data.isMEE ? " -NOW Mobile" : "";
	includedGformInstances = {};
	
	$rootScope.$on('spModel.gForm.rendered', function() {
		if ($scope.guide_step === 0) {
			addCabrilloBottomButtons({
				title: [$scope.data.msgs.nextMsg],
				fn: [$scope.goNext]
			});
		}
		$timeout(function() {
			spAtf.init().then(function(atf) {
				$scope._atf = atf;
				atf.expose('catalog_util', catalogUtil);
			});
		}, 10);
	});
	
	if ($scope.options.isServiceWorkspace && $window.frameElement) {
		var workspaceParams = {};
		workspaceParams.sysparm_parent_table = $window.frameElement.getAttribute('parent-table');
		workspaceParams.sysparm_parent_sys_id = $window.frameElement.getAttribute('parent-sys-id');
		$scope.data.workspaceParams = workspaceParams;
	}
	
	if ($scope.data.sc_cat_item) {
		$scope.data.sc_cat_item.description = $sce.trustAsHtml($scope.data.sc_cat_item.description);

		if ($scope.data.sc_cat_item.request_method == "request")
			$scope.submitButtonMsg = $scope.m.requestMsg;
		else if ($scope.data.sc_cat_item.request_method == "submit")
			$scope.submitButtonMsg = $scope.m.submitMsg;
		else
			$scope.submitButtonMsg = $scope.m.orderNowMsg;

		// Breadcrumbs
		if (!$scope.data.categories)
			$scope.data.categories = [];
		$scope.data.categories.forEach(function(category, index, categories){
			categories[index].url = category.url + '&catalog_id=' + $scope.data.catalog_id;
		});
		if ($scope.data.categories.length > 0) {
			$scope.data.categories.unshift({label: $scope.data.sc_catalog || $scope.page.title, url: '?id=' + $scope.data.sc_category_page});
			$scope.data.categories.push({label: $scope.data.sc_cat_item.name, url: '#'});
			if ($scope.data.all_catalog_msg) {
				$scope.data.categories.unshift({label: $scope.data.all_catalog_msg, url: '?id=' + $scope.data.sc_category_page + "&catalog_id=-1"});
			}
		}
		else {
			$scope.data.categories.push({label: $scope.data.sc_cat_item.name, url: '#'});
		}

		$timeout(function() {
			$scope.$emit('sp.update.breadcrumbs', $scope.data.categories);
		});
		spUtil.setSearchPage('sc');
	} else {
		var notFoundBC = [{label: $scope.page.title, url: '?id=' + $scope.data.sc_catalog_page}];
		$timeout(function() {
			$scope.$emit('sp.update.breadcrumbs', notFoundBC);
		});
		spUtil.setSearchPage('sc');
	}

	function isValidItemGform(g_form) {
		if (g_form.getSysId() === $scope.data.sc_cat_item.sys_id)
			return true;
		if ($scope.includedItems)
			for (var i in $scope.includedItems)
				if ($scope.includedItems[i].sys_id === g_form.getSysId())
					return true;
		return false;
	}


	$scope.$on('spModel.gForm.initialized', function(e, gFormInstance) {
		if (!isValidItemGform(gFormInstance))
			return;
		includedGformInstances[gFormInstance.getSysId()] = gFormInstance;
		spSCNavStateManager.register(gFormInstance);
		spSCNavStateManager.isNative($scope.data.isMEE);
		gFormInstance.$private.events.on('submitted', function(event) {
			gFormInstance.$private.processed = true;
			if (gFormInstance.getSysId() == $scope.data.sc_cat_item.sys_id) {
				$scope.$broadcast('$sp.service_catalog.form_submitted', {action_name: 'submit'});
				$scope.guide_step = 1;
				evalIncludes();
				spSCNavStateManager.unregisterForms(Object.keys(includedGformInstances));
				$scope.itemShown = 0;
			}
			else
				processChooseOptions();
		});

		if ($scope.data.isMEE) {
			cabrillo.viewLayout.showSpinner();
			cabrillo.viewLayout.setTitle($scope.data.sc_cat_item.name);
			$rootScope.$on('spModel.gForm.showNativeMobileButtons', function() {
				cabrillo.viewLayout.setTitle($scope.data.sc_cat_item.name);
				showCabrilloBottomButtons();
			});
		}
		$timeout(function() {
			$rootScope.$emit('spModel.gForm.rendered');
			if ($scope.data.isMEE) {
				cabrillo.viewLayout.hideSpinner();
			}
		}, 175);
	});

	$scope.$on('spModel.gForm.destroyed', function(e, sys_id){
		delete includedGformInstances[sys_id];
	});

	var validationComplete = $rootScope.$on('$sp.service_catalog.form_validation_complete', function() { $scope.validating = false; });

	
	/*************************************************************************************************/
	/********************************       Guide Navigation Start     *******************************/
	/*****#####################################################################################********/
	
	$scope.goPrev = function() {
		if ($scope.submitted)
			return;

		clearCabrilloBottomButtons();
		$scope.includedItems.forEach(function (item) {
			item.isOpen = false;
		})
		$scope.guide_step--;
		if($scope.guide_step==0)
			spSCNavStateManager.unregisterForms(Object.keys(includedGformInstances));

		if ($scope.guide_step === 1) {
			addCabrilloBottomButtons({
				title: [$scope.data.msgs.prevMsg, $scope.data.msgs.nextMsg],
				fn: [$scope.goPrev, $scope.goNext]
			});
		}
	}
	
	$scope.goNext = function(timeout) {
		var gForm;
		if($scope.guide_step == 0) {
			$scope.$evalAsync(function () {
				gForm = includedGformInstances[$scope.data.sys_id];
				if (!spScUtil.isRegexDone($scope.data.sc_cat_item._fields))
					$scope.validating = true;
				else if (gForm && !gForm.submit()) {
					timeout = timeout || 2000;
					if ($scope.data.isMEE)
						openItemWithInvalidFields();
					$timeout(function () {
						$scope.$broadcast('$sp.service_catalog.form_submit_failed', {action_name: 'submit'});
					}, timeout);
				}
			});
		}
		else if($scope.guide_step == 1) {
			$scope.itemsIncluded = $scope.includedItems.length;
			$scope.includedItemsCounter = 0;
			$scope.$evalAsync(function () {
				for (var i = 0; i < $scope.includedItems.length; i++) {
					if ($scope.includedItems[i].included) {
						$scope.includedItemsCounter++;
						var g_form = includedGformInstances[$scope.includedItems[i].sys_id];
						g_form.$private.processed = false;
						if (!spScUtil.isRegexDone($scope.includedItems[i]._fields))
							$scope.validating = true;
						else if (g_form && !g_form.submit()) {
							timeout = timeout || 500;
							$timeout(function () {
								$scope.$broadcast('$sp.service_catalog.form_submit_failed', {action_name: 'submit'});
								openItemWithInvalidFields();
							}, timeout);   
						}
					}
					else
						$scope.itemsIncluded--;
				}
			});
		}
	}
	
	$scope.toggleItemState = function(item) {
		if(item.included) {
			$scope.totalIncluded--;
			angular.element('#item_details_' + item.sys_id).find('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]').attr('tabindex', -1);
		}
		else {
			$scope.totalIncluded++;
			angular.element('#item_details_' + item.sys_id).find('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]').removeAttr('tabindex');
		}
	}

	function processChooseOptions() {
		var canSubmit = true;

		for (var i = 0; i < $scope.includedItems.length; i++) {
			if ($scope.includedItems[i].included) {
				var gForm = includedGformInstances[$scope.includedItems[i].sys_id];
				if (gForm && !gForm.$private.processed) {
					canSubmit = false;
					break;
				}
			}
		}
		if(canSubmit) {
			evalGuidePrice();
			spSCNavStateManager.unregisterForms(Object.keys(includedGformInstances));
			$scope.$broadcast('$sp.service_catalog.form_submitted', {action_name: 'submit'});
			$scope.guide_step = 2;
			$scope.showAddToCart = $scope.options.show_add_cart_button == 'true' && !$scope.data.sc_cat_item.no_cart;
			addCabrilloBottomButtons({
				title: [i18n.getMessage('Add to Cart'), $scope.submitButtonMsg],
				fn: [$scope.triggerAddToCart, $scope.triggerSubmit]
			});
		}
	}

	var openItemWithInvalidFields = (function(){
		var formsValidated = 0;
		return function() {
			formsValidated++;
			if (formsValidated == $scope.itemsIncluded) {			
				var someFormIsInvalid = false;
				for (var i=0; i < $scope.includedItems.length; i++) {
					if ($scope.includedItems[i].included) {
						var gForm = includedGformInstances[$scope.includedItems[i].sys_id];
						if (!gForm)
							return;
						
						var fields = gForm.getFieldNames();
						for (var j=0; j<fields.length; j++) {
							var field = gForm.getField(fields[j]);
							if (field.isInvalid) {
								if ($scope.data.isMEE) {
									$scope.includedItems[i].isOpen = true;
									$scope.showCancel($scope.includedItems[i].sys_id);
								}
								else
									$scope.includedItems[i].isOpen = true;

								someFormIsInvalid = true;
								break;
							}					
						}
						if ($scope.data.isMEE && someFormIsInvalid)
							break;
					}
				}
				formsValidated = 0;		
				if (!$scope.data.isMEE)
					focusInvalidField();	
			}
		}
	})();

	function focusInvalidField(){     
		$timeout(function() {
			for (var i = 0; i < $scope.includedItems.length; i++) {
				if ($scope.includedItems[i].included) {
					var mandatory = $scope.includedItems[i]._mandatory;
					if (mandatory && mandatory.length > 0) {
						var elems = angular.element("[name*='" + mandatory[0].name + "']");
						if (elems && elems.length > 0) //set focus the first element
							elems[0].focus();
						break;
					} else {
						var gForm = includedGformInstances[$scope.includedItems[i].sys_id];
						getInvalidFields(gForm);
						var invalidFields = gForm._invalidFields;
						if (invalidFields && invalidFields.length > 0) {
							var invalid = angular.element("[name*='" + invalidFields[0].name + "']");
							if (invalid && invalid.length > 0) //set focus the first element
								invalid[0].focus();
							break;
						}
					}
				}
			}
		}, 500);
	}
	
	$scope.closeItemAccordion = function (itemOpened) {
		itemOpened.isOpen = false;
		cabrillo.viewLayout.setNavigationBarButtons();
		cabrillo.viewLayout.setTitle($scope.data.sc_cat_item.name);
		addCabrilloBottomButtons({
			title: [$scope.data.msgs.prevMsg, $scope.data.msgs.nextMsg],
			fn: [$scope.goPrev, $scope.goNext]
		});
		$scope.isItemOpened = false;
	}
	
	$scope.showItem = function(index) {
		if($scope.itemShown == index)
			$scope.itemShown = -1;
		else
			$scope.itemShown = index;
	}

	$scope.showCancel = function(id) {
		var itemOpened, buttons;
		if ($scope.data.isMEE) {
			clearCabrilloBottomButtons();
			cabrillo.viewLayout.setNavigationBarButtons();
			cabrillo.viewLayout.hideBackButton();
			itemOpened = $scope.includedItems.find(function (item) {
				return item.sys_id === id;
			});

			cabrillo.viewLayout.setTitle(itemOpened.name);
			buttons = [
				{
					title: i18n.getMessage('Done'),
					enabled: true
				}
			];

			cabrillo.viewLayout.setNavigationBarButtons(buttons, function(index) {
				$scope.closeItemAccordion(itemOpened);
			});
		}
		$scope.isItemOpened = true;
	}
	
	/********************************************************************************************/
	/********************************     Guide Navigation End    *******************************/
	/*****###############################################################################********/
	/********************************************************************************************/
	/********************************         Attachments         *******************************/
	/*****###############################################################################********/
	
	function initAttachmentHandlers() {
		var setAttachments;
		var appendError = function (error) {
			spUtil.addErrorMessage(error.msg + error.fileName);
		};
		for (var i = 0; i < $scope.includedItems.length; i++) {
			$scope.includedItems[i].attachmentHandler = new nowAttachmentHandler(setAttachments, appendError);
			$scope.includedItems[i].attachmentHandler.setParams($scope.includedItems[i].targetTable, $scope.includedItems[i].sysparm_item_guid, 1024 * 1024 * $scope.data.maxAttachmentSize);
		}
	}
	
	$scope.$on('dialog.upload_too_large.show', function(e){
		$log.error($scope.m.largeAttachmentMsg);
		spUtil.addErrorMessage($scope.m.largeAttachmentMsg);
	});

	$scope.initAttachmentCallbacks = function (itemIndex) {
		$scope.includedItems[itemIndex].attachmentHandler.setAttachments = function (attachments, action) {
			$scope.includedItems[itemIndex].attachments = attachments;
			if (action === "added") {
				$scope.includedItems[itemIndex].attachment_submitted = true;
			}
			if (action === "renamed")
				spAriaUtil.sendLiveMessage($scope.m.renameSuccessMsg);
			if (action === "deleted") {
				spAriaUtil.sendLiveMessage($scope.m.deleteSuccessMsg);
				if ($scope.includedItems[itemIndex].attachments.length == 0)
					$scope.includedItems[itemIndex].attachment_submitted = false;
			}
			$scope.includedItems[itemIndex].attachment_action_in_progress = false;
			spUtil.get($scope,{action: "from_attachment"});
		};

		$scope.includedItems[itemIndex].confirmDeleteAttachment = function(attachment) {
			spModal.confirm($scope.data.msgs.delete_attachment).then(function() {
				$scope.includedItems[itemIndex].attachmentHandler.deleteAttachment(attachment);
				$scope.includedItems[itemIndex].attachment_action_in_progress = true;
				$scope.setFocusToAttachmentButton();
			});
		}
	}
	
	/********************************************************************************************/
	/********************************       Attachments  End      *******************************/
	/*****###############################################################################********/
	/********************************************************************************************/
	/********************************        UTIL Functions       *******************************/
	/*****###############################################################################********/

	function evalGuidePrice() {
		$scope.price = 0;
		var frequencyMap = {};
		for (var i = 0; i < $scope.includedItems.length; i++) {
			if ($scope.includedItems[i].included && $scope.includedItems[i].process_price) { 
				var qty = parseInt($scope.includedItems[i].quantity);
				var pricing = $scope.includedItems[i]._pricing;
				var effectivePrice = 0;
				var effectiveRecurringPrice = 0;
				if (typeof $scope.includedItems[i].price != "undefined") {
					effectivePrice = $scope.includedItems[i].price;
				}
				if (typeof $scope.includedItems[i].recurring_price != "undefined") {
					effectiveRecurringPrice = $scope.includedItems[i].recurring_price;
				}

				if (effectiveRecurringPrice >= 0 && pricing.rfd) {
					if(frequencyMap[pricing.rfd])
						frequencyMap[pricing.rfd] += effectiveRecurringPrice * qty;
					else
						frequencyMap[pricing.rfd] = effectiveRecurringPrice * qty;
				}
				if (effectivePrice >= 0)
					$scope.price += effectivePrice * qty;
			}
		}
		frequencyMap.price = $scope.price;
		$scope.server.get({
			action: "format_prices",
			prices: frequencyMap
		}).then(function(response) {
			$scope.frequencySequence = response.data.frequencySequence;
			$scope.price_display = response.data.frequencyMap.price;
			$scope.frequencyMap = response.data.frequencyMap;
		});
	}
	
	function evalIncludes() {
		// don't allow submit while waiting on included items eval
		$scope.evaluatingIncludes = true;
		$scope.includedItems = [];
		var guideData = getFieldsData($scope.data.sc_cat_item);
		guideData.sysparm_id = $scope.data.sys_id;
		guideData.without_cart = true;
		guideData._fields = $scope.data.sc_cat_item._fields;
		guideData.cascade = $scope.data.sc_cat_item.cascade;
		if ($scope.data.workspaceParams) {
			guideData.sysparm_parent_sys_id = $scope.data.workspaceParams.sysparm_parent_sys_id;
			guideData.sysparm_parent_table = $scope.data.workspaceParams.sysparm_parent_table;
		}
		$scope.server.get({
			action: "init_guide",
			orderGuideData: guideData
		}).then(function(response) {
			if (response.data.error) {
				$scope.guide_step--;
				return;
			}
			$scope.includedItems = response.data.items;
			$scope.showIncludeToggle = response.data.showIncludeToggle;
			initAttachmentHandlers();
			$scope.includedItems.forEach(function(item) {
				item.description = $sce.trustAsHtml(item.description);
			});
			$scope.totalIncluded = $scope.includedItems.length;
			$scope.conflictingCartDomainMsg = response.data.conflictingCartDomainMsg;
			$scope.evaluatingIncludes = false;

			addCabrilloBottomButtons({
				title: [$scope.data.msgs.prevMsg, $scope.data.msgs.nextMsg],
				fn: [$scope.goPrev, $scope.goNext]
			});
		});
	}
	
	function getInvalidFields(gForm) {
		gForm._invalidFields = [];
		var fields = gForm.getFieldNames();
		for (var j = 0; j < fields.length; j++) {
			var field = gForm.getField(fields[j]);
			if (field.isInvalid)
				gForm._invalidFields.push(field);
		}
	}	
	
	function getCurrentGForm() {
		if ($scope.guide_step == 0)
			return includedGformInstances[$scope.data.sc_cat_item.sys_id];
		else {
			var openItem = $scope.includedItems.find(function(item){
				return item.isOpen === true;
			});
			return includedGformInstances[openItem.sys_id];
		}
	}
	
	function openItemHelper(item, state, defer) {
		for (var i = 0; i < $scope.includedItems.length; i++)
			if ($scope.includedItems[i].sys_id == item) {
				$scope.includedItems[i].included = state == 'true';
				$scope.includedItems[i].isOpen = true;
				$scope._atf.expose('g_form', spAtf.augmentForm(includedGformInstances[item]));
				defer.resolve();
			}
	}

	function getFieldsData(item) {
		var fieldData = {"variables":{}};
		for(var field in item._fields) {
			var fieldValue = "";
			if (item._fields[field].value != null && typeof item._fields[field].value != "string")
				fieldValue = JSON.stringify(item._fields[field].value);
			else
				fieldValue = item._fields[field].value;
			fieldData.variables[item._fields[field].name] = fieldValue;

		}
		return fieldData;
	}

	function getGuideItems(cartname) {
		var items = [];
		var item;
		for(var i = 0; i < $scope.includedItems.length; i++) {
			if($scope.includedItems[i].included) {
				item = getFieldsData($scope.includedItems[i]);
				item.sysparm_id = item.sysparm_active = $scope.includedItems[i].sys_id;
				item.sysparm_quantity = $scope.includedItems[i].quantity;
				item.sysparm_cart_name = cartname;
				item.sysparm_item_guid = $scope.includedItems[i].sysparm_item_guid;
				items.push(item);
			}
		}
		return items;
	}
	
	/*********************************************************************************************/
	/********************************          UTIL Functions End           **********************/
	/*****################################################################################********/
	/*********************************************************************************************/
	/********************************           Submit Handlers             **********************/
	/*****################################################################################********/
	
	$scope.triggerAddToCart = function() {
		var webAnalyticsMsgSuffix = $scope.data.isMEE ? " - NOW Mobile" : "";
		clearCabrilloBottomButtons();
		if($scope.conflictingCartDomainMsg) {
			spUtil.addErrorMessage($scope.conflictingCartDomainMsg);
			return;
		}
		if($scope.submitted)
			return;
		$scope.server.get({
			action: 'log_request',
			itemDetails: {sys_id: $scope.data.sc_cat_item.sys_id, 
										name: $scope.data.sc_cat_item.name,
										sys_class_name: $scope.data.sc_cat_item.sys_class_name}
		});
		$scope.submitted = true;
		$scope.server.get({
			action: "add_to_cart",
			items: getGuideItems(""),
			sys_id: $scope.data.sys_id
		}).then(function(response) {
			$rootScope.$broadcast("$sp.service_catalog.cart.add_item");
			$rootScope.$broadcast("$sp.service_catalog.cart.update");
			$scope.$emit("$sp.sc_order_guide.add_to_cart");
			window.GlideWebAnalytics.trackEvent('Service Catalog', 'Catalog Cart' + webAnalyticsMsgSuffix, 'Order Guide Added to Cart', 0, 0);
			if($scope.data.isMEE) {
				$scope.submitted = true;
				cabrillo.message.showMessage(cabrillo.message.SUCCESS_MESSAGE_STYLE, i18n.getMessage('Items have been added successfully to your cart'));
				$timeout(function () {
					cabrillo.flowControl.flowEnded();
					return;
				}, 200);
				return;
			}

			spModal.open({
				message: i18n.getMessage('Items have been added successfully'),
				size: 'sm',
				backdrop: 'static',
				keyboard: false,
				noDismiss: true,
				buttons: [
					{label: i18n.getMessage('Catalog Home'), cancel:true},
					{label: i18n.getMessage('View Cart'), primary:true}
				]
			}).then(function() {
				$location.search("id=sc_cart");
			}, function() {
				$location.search("id=sc_home");
			});
		});
	}
	
	// order / create request
	$scope.triggerSubmit = function() {
		clearCabrilloBottomButtons();
		if ($scope.submitted)
			return;

		$scope.server.get({
			action: 'log_request',
			itemDetails: {sys_id: $scope.data.sc_cat_item.sys_id, 
										name: $scope.data.sc_cat_item.name,
										sys_class_name: $scope.data.sc_cat_item.sys_class_name}
		});
		$scope.submitted = true;
		var hasItems = $scope.includedItems.filter(function(item) {
			return item.sys_class_name != 'sc_cat_item_producer';
		}).length > 0;

		if ($scope.data.sys_properties.twostep && $scope.data.sc_cat_item.request_method != "submit") {
			//Required to pass as payload for usage as embeddedWidget
			var embeddedWidgetOptions = {
				"auto_redirect" : "true",
				"requested_for_id" : "",
				"requested_for_display" : ""
			};
			var payload = {
				cart: '' + $scope.data.sys_id,
				itemDetails: {
					items: getGuideItems('' + $scope.data.sys_id),
					request_method: $scope.data.sc_cat_item.request_method
				},
				workspaceParams: $scope.data.workspaceParams,
				action: "order_guide"
			};
			for (var embeddedOption in embeddedWidgetOptions) {
				payload[embeddedOption] = c.options[embeddedOption] || embeddedWidgetOptions[embeddedOption];
			}
			$scope.server.get(payload).then(function(response) {
				var orderGuideModalCtrl;
				var unregister = $scope.$on('$sp.service_catalog.cart.cancel_order', function(){
					orderGuideModalCtrl.close();
					$scope.submitted = false;
					$timeout(function () {
						addCabrilloBottomButtons({
							title: [i18n.getMessage('Add to Cart'), $scope.submitButtonMsg],
							fn: [$scope.triggerAddToCart, $scope.triggerSubmit]
						});
					});
				});
				var closeModalOnSubmit = $scope.$on("$sp.service_catalog.cart.submitted", function () {
					orderGuideModalCtrl.close();
					$scope.submitted = true;
				});
				var orderGuideModal = angular.copy(response.data.orderGuideModal);
				orderGuideModal.options.afterOpen = function(ctrl){
					orderGuideModalCtrl = ctrl;
				};
				orderGuideModal.options.afterClose = function() {
					unregister();
					closeModalOnSubmit();
					$scope.orderGuideModal = null;
					orderGuideModalCtrl = null;
				};
				$scope.orderGuideModal = orderGuideModal;
			});
			return $scope.submitted;
		} else {
			$scope.data.action = 'checkout_guide';
			$scope.data.guideItems = getGuideItems('' + $scope.data.sys_id);
			$scope.server.update().then(function(response) {
				$scope.data.action = undefined;
				$scope.data.guideItems = undefined;
				$scope.$emit("$sp.sc_order_guide.submitted", $scope.data.result);
				window.GlideWebAnalytics.trackEvent('Service Catalog' + webAnalyticsMsgSuffix, 'Order Guide Request', 'Catalog Request Submitted', $scope.includedItemsCounter, 0);
				$scope.submitted = true;
				if ($scope.options.auto_redirect == 'false') {
					spUtil.addInfoMessage($scope.m.requestSubmitted);
					return;
				}
				else {
					if ($scope.data.result.request_id) 
						$location.search('id=sc_request&is_new_order=true&table=sc_request&sys_id=' + $scope.data.result.request_id);
					else 
						$location.search('id=requests');

				}
			});
			return $scope.submitted;
		}
	}
	
	/*********************************************************************************************/
	/********************************        Submit Handlers End           ***********************/
	/*****################################################################################********/
	
	var catalogUtil = {
		updateGform: function() {
			var g_form = getCurrentGForm();
			if (g_form)
				$scope._atf.expose('g_form', spAtf.augmentForm(g_form));
		},

		addRow: function(fieldId, timeoutInMS) {
			var deferred = $q.defer();
			var g_form = getCurrentGForm();
			if (g_form) {
				if (timeoutInMS <= 0)
					timeoutInMS = 1000;
				$scope.$broadcast("$sp.sc_multi_row.create_row", fieldId, g_form.getSysId());
				$scope.$on('spModel.gForm.initialized', function(e, gFormInstance) {
					if (gFormInstance.getSysId() == fieldId)
						deferred.resolve();
				});
				$timeout(function() {
					deferred.reject();
				}, timeoutInMS);
			}
			else
				deferred.reject();
			return deferred.promise;
		},

		navigateToStep: function(num, timeout) {
			var defer = $q.defer();
			var step = parseInt(num) - 1;
			if (Math.abs(step - $scope.guide_step) != 1) {
				defer.reject("Can't navigate to next step");
				return defer.promise;
			}
			if (step > $scope.guide_step)
				$scope.goNext(timeout);
			else {
				$scope.goPrev();
				defer.resolve();
			}
			var cleanup = $scope.$on('$sp.service_catalog.form_submit_failed', function() {
				cleanup();
				defer.reject("Can't navigate to next step");
			});
			var cleanup1 = $scope.$on('$sp.service_catalog.form_submitted', function() {
				cleanup1();
				defer.resolve("Can navigate to next step");
			});
			return defer.promise;
		},

		validateIncludedList: function(list, stage) {
			var items = list.split(',').reduce(function(obj, item) {
				obj[item] = false;
				return obj;
			}, {});
			var included = stage == 1 ? $scope.includedItems : $scope.includedItems.filter(function(item) {
				return item.included == true;
			});
			if (Object.keys(items).length != included.length)
				return false;
			for (var i = 0; i < included.length; i++)
				if (!items.hasOwnProperty(included[i].sys_id))
					return false;
			return true;
		},

		openItem: function(item, state, timeoutInMS) {
			if (timeoutInMS <= 0)
				timeoutInMS = 10000;
			var defer = $q.defer();
			if (includedGformInstances[item]) {
				openItemHelper(item, state, defer);
			}
			$scope.$on('spModel.gForm.initialized', function(e, gFormInstance) {
				if (gFormInstance.getSysId() == item) {
					openItemHelper(item, state, defer);
				}
			});
			$timeout(function() {
				defer.reject();
			}, timeoutInMS);
			return defer.promise;
		},

		getPrice: function() {
			var res = {};
			var item = $scope.includedItems.find(function(itemData) {
				return itemData.isOpen == true;
			});
			if (item) {
				res.price = item.price;
				res.recurring_price = item.recurring_price;
				res.recurring_frequency = item.recurring_frequency;
			}
			return res;
		},

		getGuidePrice: function() {
			return $scope.price_display;
		},

		addToCart: function() {
			var defer = $q.defer();
			$scope.triggerAddToCart();
			if (!$scope.submitted)
				defer.reject("Can't submit form.");
			else
				defer.resolve();
			return defer.promise;
		},

		submitOrderGuide: function() {
			var defer = $q.defer();
			if ($scope.triggerSubmit()) {
				if ($scope.data.sys_properties.twostep && $scope.data.sc_cat_item.request_method != "submit") {
					defer.resolve();
				}
				else{
					var cleanUp = $scope.$on('$sp.sc_order_guide.submitted', function(o, result) {
						$timeout(function() {
							cleanUp();
							result.single_step = true;
							defer.resolve(result);
						}, 10);
					});
				}
			}
			else
				defer.reject();
			return defer.promise;
		}
	};
	
	/********************************************************************************************/
	/********************************                ATF End            *************************/
	/*****###############################################################################********/
	/********************************************************************************************/
	/********************************            Cabrillo Start         *************************/
	/*****###############################################################################********/
	
	function clearCabrilloBottomButtons() {
		if ($scope.data.isMEE) {
			cabrillo.viewLayout.setBottomButtons();
		}
	}

	function showCabrilloBottomButtons() {
		if (!$scope.data.isMEE) return;

		if ($scope.guide_step === 0) {
			addCabrilloBottomButtons({
				title: [$scope.data.msgs.nextMsg],
				fn: [$scope.goNext]
			});
		}

		if ($scope.guide_step === 1) {
			var itemOpened = $scope.includedItems.find(function (item) {
				return item.isOpen;
			});

			if (itemOpened) {
				$scope.showCancel(itemOpened.sys_id);
			}
		}
	}
	
	function addCabrilloBottomButtons(buttonDetails) {
		if ($scope.data.isMEE) {
			var buttons = [];
			clearCabrilloBottomButtons();
			switch($scope.guide_step) {
				case 0:
					buttons = [
						{
							title: buttonDetails.title[0],
							enabled: true,
							backgroundColor: $scope.data.sys_properties.mobileNativeColor,
							textColor: '#FFFFFF'
						}];

					cabrillo.viewLayout.setBottomButtons(buttons, function(buttonIndex) {
						buttonDetails.fn[buttonIndex]();
					});
					cabrillo.viewLayout.showBackButton();
					break;

				case 1:
					buttons = [
						{
							title: buttonDetails.title[0],
							enabled: true,
							backgroundColor: '#f7f7f7',
							textColor: '#000000'
						},
						{
							title: buttonDetails.title[1],
							enabled: true,
							backgroundColor: $scope.data.sys_properties.mobileNativeColor,
							textColor: '#FFFFFF'
						}];
					cabrillo.viewLayout.setBottomButtons(buttons, function(buttonIndex) {
						//Disable next button in choose option if all the items are marked as not included.
						// however the previous button should still work
						if (!($scope.submitted || $scope.totalIncluded <= 0) || buttonIndex === 0) {
							buttonDetails.fn[buttonIndex]();
						}
					});
					cabrillo.viewLayout.hideBackButton();
					break;

				case 2:
					if ($scope.data.sys_properties.cartEnabled && $scope.showAddToCart) {
						buttons = [
							{
								title: buttonDetails.title[0],
								enabled: true,
								backgroundColor: '#f7f7f7',
								textColor: '#000000'
							},
							{
								title: buttonDetails.title[1],
								enabled: true,
								backgroundColor: $scope.data.sys_properties.mobileNativeColor,
								textColor: '#FFFFFF'
							}];
						cabrillo.viewLayout.setBottomButtons(buttons, function(buttonIndex) {
							buttonDetails.fn[buttonIndex]();
						});
					} else {
						buttons = [
							{
								title: buttonDetails.title[1],
								enabled: true,
								backgroundColor: $scope.data.sys_properties.mobileNativeColor,
								textColor: '#FFFFFF'
							}];
						cabrillo.viewLayout.setBottomButtons(buttons, function(buttonIndex) {
							buttonDetails.fn[1]();
						});
					}
					cabrillo.viewLayout.hideBackButton();
					break;
			}
		}
	}
	
	var mespOpenPopupUnregister = $rootScope.$on("mesp.popup.open", function() {
		// Timeout is to give a better user experience otherwise when this popup opens,
		// the cabrillo buttons will be displayed immediately giving a bad user experience.
		$timeout(function(){
			clearCabrilloBottomButtons();
		});
	});

	var mespClosePopupUnregister = $rootScope.$on("mesp.popup.close", function() {
		// Timeout is to give a better user experience otherwise when this popup opens,
		// the cabrillo buttons will be displayed immediately giving a bad user experience.
		$timeout(function(){
			showCabrilloBottomButtons();
		});
	});
	
	/**********************************************************************************************/
	/********************************            Cabrillo End           ****************************/
	/*****##################################################################################********/
}]]></client_script>
        <controller_as>c</controller_as>
        <css>.order-guide-mobile {
  border: 0;
  box-shadow: none;
  
  .mobile-attachment-label {
    float: none;
    display: flex;
    justify-content: center;
    margin-top: 10px;
    button, .add-attachment-content {
      color: $link-color;
    }
  }
  
  .mobile-summary{
  	display: flex;
    align-items: center;
    justify-content: space-between;
  }
  
  .iconlink {
  	padding: 0 !important;
    width: 100%;
    span.step-text {
      font-weight: bold;
      font-size: 20px;
      margin: 0 !important;
      top: 0;
      padding-left: 5px;
    }
  }
  
  .less-text .read-more,
  .more-text .read-less {
    display: block;
    text-align: center;
    margin: 10px auto;
  }
  
  .list-group-mobile {
		.accordion-header {
      &amp;.disable-row .accordion-toggle {
        pointer-events: none;
        color: $gull-grey;
      }

      .accordion-toggle {
        &amp;:focus {
        	border: 0;
          box-shadow: none;
        }
        
        .row {
          padding: 20px 0;
          margin: 0 !important;
          &amp;&gt;div {
          	padding: 0;
          }
        }
        
        .og-check-bucket {
          display: block;
          padding-left: 10px;
          height: 20px;
          width: 60px;

          input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
          }

          .og-check {
            position: absolute;
            pointer-events: auto;
            top: -3px;
            height: 30px;
            width: 30px;
            background-color: #fff;
            border: 1px solid $mesp-input-border;
            border-radius: 50%;

            &amp;:after {
              content: "";
              position: absolute;
              display: none;
              left: 12px;
              top: 8px;
              width: 5px;
              height: 10px;
              border: solid #fff;
              border-width: 0 2px 2px 0;
              -webkit-transform: rotate(45deg);
              -ms-transform: rotate(45deg);
              transform: rotate(45deg);
            }
          }

          input:checked ~ .og-check {
            background-color: $mesp-input-radio;
            &amp;:after {
              display: block;
            }
          }
        }

        .og-mobile-item {
          display: grid;
          grid-template-columns: auto 100px;
					
          .item-name {
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
            
            &amp; ~ label {
            	justify-self: end;
            }
          }
          
          .options {
          	color: $gull-grey;
          }
          
          .accordion-icon {
            margin-left: 12px;
            padding-right: 3px;

            &amp;:before {
              content: "\f105";
              font-family: FontAwesome;
              font-size: 20px;
            }
          }
        }
      }

      .collapsing {
        transition: none;
      }

	    .panel-heading, .panel-heading:hover {
        background-color: transparent;
      }
    }
   
    .guide-item-details-wrapper-mobile {      
      position: fixed !important;
      background-color: #FFF !important;
      z-index: 1 !important;
      height: 100% !important;
      width: 100% !important;
      top: 0 !important;
      left: 0 !important;
      overflow: scroll;
      
      .title-mobile {
        font-size: 22px;
        font-weight: 600;
      }
      
      .og-item-price {
        padding: 23px 0px 23px 14px;
        margin: 18px -8px 0px -8px;
        border-top: 1px solid $mesp-input-border;
        strong {
          font-size: 18px;
        }
        span {
          font-size: 14px;
        }
        label {
          display: block;
          color: $gull-grey;
        }
      }
    }
    
    .summary {
      section {
	      display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 5px 5px 5px 0;
      }
      
      .guide-item {
      	display: flex;
        align-items: center;
      }
      
      .guide-item-quantity {
        padding: 5px 10px;
        margin: 0 10px 0 0;
        background-color: #F0F0F0;
        border-radius: 5px;
      }
      
      .guide-item-name {
      	display: flex;
        flex-direction: column;
        align-items: flex-start;
      }
    }
  }
}

.guide-item-details-wrapper {
	position: relative;
  background-color: #F8F9F9;
}

.empty-state-content {
  margin-top: 30px;

  h3 {
    margin-bottom: 5px;
    text-align: center;
  }
}

.attachment-label {
  float: right;
  font-weight: normal;
  cursor: pointer;
}

.guide-image {
  max-height: 240px;
  padding: 5px;
  display: inline;
}

.panel-button {
  float: none;
}

.file-list-wrap {
	margin-bottom: 10px;
}

.guide-item-image {
  max-height: 150px;
  padding: 10px;
  display: inline-block !important;
}

.item-icon {
  max-width:100%;
  height:auto;
}

.disabled-mask {
  background-color: #F8F9F9;
  position: absolute;
  z-index: 8;
  opacity: 0.6;
  height: 100%;
  width: 100%;
  top: 0;
  left: 0;
  border-radius: 5px;
  cursor: not-allowed;
}

.guide-description, .guide-nav, .tab-item, .og-timeline {
  overflow: auto;
}


.guide-nav {
  padding: 0px 40px 20px 40px;
}

.guide-nav-setp1 {
  padding-right: 27px;
}

.iconlink {
  margin: 5px 0px 5px 0px;
}

.circle_icon {
    border: 3px solid;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    padding: 20px;
    display: inline-block;
    .step-icon {
      font-size: 20px;
    	position: relative;
    	top: -9px;
    	left: -10px;
    }
}

.step-text {
  	position: relative;
    top: -10px;
}

.step_active {
  color: $primary;
}

.step_inactive {
  color: $text-muted;
  opacity: 0.5;
}

.accordion-header {
  .panel-heading {
    padding: 0;
    .row {
      padding: 15px;
      margin: 0;
    }
    .align-text {
      top: 3px;
    }
    &amp;:hover {
    	background-color: lighten($primary, 45%);
  	}
    label {
      font-size: inherit;
    }
  }
  &amp;.panel-open {
    .panel-heading {
      border-bottom: 1px solid #dee5e7;
      &amp;:hover {
    		background-color: transparent;
  		}
    }
  }
  .panel-title {
    	font-size: inherit;
  }
}

.list-group {
	padding-left: 28px;
  padding-right: 28px;
  padding-top: 10px;
  padding-bottom: 0px;
}

.accordion-icon {
  margin-left: 30px;
}


.mandatory-header {
  border-left: 3px #d9534f solid !important;
}

.mandatory-icon {
  color: #d9534f;
  margin-left: -9px
}

.timeline-container {
  position: sticky;
  position: -webkit-sticky;
  position: -ms-sticky;
  height:auto;
  top: -($font-size-h2 + $font-size-base + 48px);
  z-index: 10;
  background-color: inherit;
  border-radius: 4px 4px 0 0;
}

.og-timeline .iconlink label {
  font-weight: 600;
  font-size: 0.8em;
  line-height: 1.8em;
}

.include-loader {
  text-align: center;
  
}

.og-switch {
  .input-switch {
    font-size: inherit;
    label.switch {
      border-radius: 20px;
      &amp;::before {
        border-radius: 20px;
      }
    }
    input[type=checkbox]:checked ~ .switch {
    	background-color: $primary;
		}
  }
}

.summary {
  tr {
    height: 69px;
  }
  margin-bottom: 0;
  .summary-excluded {
    color: #ccc;
  }
  .not-included-pill {
    color: #FFF;
    background-color: #f0ad4e;
    border-radius: 20px;
    font-size: 11px;
    font-weight: bolder;
    white-space: nowrap;
  }
}

.m-r-6 {
  margin-right: 6px !important;
}

.wrap-word {
  word-break: break-word;
  hyphens: auto;
}

//animation

.fa-pulse {
  -webkit-animation: fa-spin 1s infinite steps(8);
  animation: fa-spin 1s infinite steps(8);
}

.options {
  color: $primary;
}

@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
/* IE10+ CSS styles go here */
   .timeline-container {
   position: static;
   top: 0px;
   }
}
@media only screen and (max-width:992px) {
  .pull-left-xs {
    float: left !important;
  }
  
  .left-align-xs {
    text-align: left !important;
  }
  
  .padding-left-xs {
    padding-left:15px !important;
  }
  
  .iconlink {
    padding: 0 15px;
  }
  
  .wrapper-cart-xs {
    padding: 10px !important;
  }
  
  .not-included {
    padding: 3px !important;
  }
  
  .pull-right-xs {
    float: right !important;
  }
  
  .remove-margin-bottom-xs {
    margin-bottom: 0px !important;
  }
  
  .add-margin-bottom-xs {
    margin-bottom: 15px !important;
  }
  
  .list-group {
    padding-left: 13px !important;
    padding-right: 13px !important;
  }

  .border-top-xs {
    border-top: none;
  }
  
  .border-bottom-xs {
    border-bottom: none;
  }
  
  .button-image-xs {
    padding-left: 7%;
    line-height: 160%;
  }
  
  .guide-image {
    display: block;
    margin: auto;
    max-height: 220px
  }
  
  .og-switch {
    padding-top:10px;
    .input-switch {
      margin-left: 5px !important;
    }
    .input-switch input[type=checkbox]  ~ .switch {
       height: 20px;
       width: 35px
    }
    .input-switch input[type=checkbox]:checked  ~ .switch:before {
      left: 15.5px;
    }
   }
  .summary {
     tr {
         height: 33px;
      }
    .summary-excluded {
    	color: inherit;
  	}
  }
  .timeline-container {
    top: -($font-size-h2 + $font-size-base + 28px);
  }
  .guide-nav-setp1 {
    padding: 0 13px 20px 13px;
  }
	.timeline-container {
     position: inherit;
  }
  .included-xs {
    font-size:13px; 
    vertical-align:3px;
  }
  .panel-body {
    padding: 0;
  }
  .guide-item-image-xs {
    max-height: 120px;
  	padding: 10px;
    float: left;
  }
  .guide-description {
    display: inline;
  }
  .read-more, .read-less {
    font-size: 15px;
    cursor: pointer;
  }
  .more-text {
    display: none;
  }
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list>color,title</field_list>
        <has_preview>false</has_preview>
        <id>gservice_sc_order_guide</id>
        <internal>false</internal>
        <link><![CDATA[function(scope, elem) {
		scope.setFocusToAttachmentButton = function () {
			elem.find('.sp-attachment-add')[0].focus();
		}
	}
	]]></link>
        <name>GService SC Order Guide</name>
        <option_schema>[{"hint":"This property will 'show less' description of order guide with an option of 'read more' to read full description.","name":"show_less_orderguide","default_value":"true","section":"Presentation","label":"Enable Show More/Less for Order Guide description on Mobile","type":"boolean"},{"hint":"Show the widget in compact mode","name":"compact_mode","section":"Presentation","default_value":"false","label":"Compact Mode","type":"boolean"},{"hint":"Hide Delivery Time in each Item","name":"hide_delivery_time","section":"Presentation","default_value":"false","label":"Hide Delivery Time","type":"boolean"},{"hint":"Show the add to cart button","name":"show_add_cart_button","section":"Behavior","default_value":"true","label":"Show Add to Cart","type":"boolean"}]</option_schema>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function () {
	var guideJS;
	data.isTwoStepEnabled = gs.getProperty('glide.sc.sp.twostep');
	var localInput = input; //to safeguard pullution of "input" via BR or other scripts
	
	if (localInput && localInput.action == "from_attachment")
		return;

	data.sys_id = $sp.getParameter("sys_id");	
	['auto_redirect', 'requested_for_id', 'requested_for_display'].forEach(function (embeddedWidgetOption) {
		if (localInput && typeof localInput[embeddedWidgetOption] != 'undefined')
			options[embeddedWidgetOption] = localInput[embeddedWidgetOption];
	});
	
	if(localInput && localInput.action == 'order_guide') {
		data.orderGuideModal = $sp.getWidget('widget-modal', {
																											embeddedWidgetId: 'sc-checkout', 
																											embeddedWidgetOptions: {
																																	cart: {name: localInput.cart}, 
																																	action: localInput.action, 
																																	item: localInput.itemDetails, 
																																	requested_for: {id:options.requested_for_id, displayValue:options.requested_for_display}, 
																																	auto_redirect: options.auto_redirect,
																																	parentParams: localInput.workspaceParams,
																																	native_mobile: options.native_mobile
																																}, 
																											backdrop: 'static', 
																											keyboard: false, 
																											size: 'md'
																								});
		return;
	}
	else if (localInput && localInput.action === 'log_request') {
		 $sp.logStat('Cat Item Request', localInput.itemDetails.sys_class_name, localInput.itemDetails.sys_id, localInput.itemDetails.name, $sp.getPortalRecord().getUniqueValue());
		 return;
	}
	else if(localInput && localInput.action == "init_guide") {
		guideJS = new sn_sc.OrderGuide('' + localInput.orderGuideData.sysparm_id);
		var temp = guideJS.init(localInput.orderGuideData);
		if (JSUtil.notNil(temp.errMsg)) {
			gs.addErrorMessage(temp.errMsg);
			data.error = true;
			return;
		}
		data.showIncludeToggle = guideJS.isIncludeItems();
		data.items = [];
		var item;
		for(var i = 0; i < temp.items.length; i++) {
			var catItem = new sn_sc.CatItem('' + temp.items[i].sys_id);
			if(!catItem.canView() || !catItem.isVisibleServicePortal())
				continue;
			var itemData = {
				'sys_id': temp.items[i].sys_id, 
				'table': 'sc_cat_item', 
				'quantity': temp.items[i].quantity, 
				'is_guide': true, 
				'is_ordering': true,
				'variables' : {}
			};
			if (localInput.orderGuideData.cascade) {
				for (var gf in localInput.orderGuideData._fields) {
					var field = localInput.orderGuideData._fields[gf];
					itemData.variables[field.name] = field.value;	
				}
			}
			item = $sp.getCatalogItem(itemData);
			item.quantity = temp.items[i].quantity;
			item.show_quantity = temp.items[i].show_quantity;
			item.isOrderGuideItem = true;
			item.included = true;
			item.sysparm_item_guid = gs.generateGUID();
			item._attachmentGUID = item.sysparm_item_guid;
			item.order = parseInt(temp.items[i].order);
			item.native_mobile = options.native_mobile == 'true';
			
			var table_name = 'sc_cart_item';
			var className = item.sys_class_name;
			if (!new global.CatalogItemTypeProcessor().canCreateNormalCartItem(className)) {
				if (className == 'sc_cat_item_producer') {
					var gr = new GlideRecord('sc_cat_item_producer');
					if (gr.get(item.sys_id))
						table_name = gr.getValue('table_name');
				}
			}
			item.targetTable = table_name;
			if (localInput.orderGuideData.cascade) {
				for (var field in item._fields) {
					var f = item._fields[field];
					for (var gf in localInput.orderGuideData._fields) {
						if (localInput.orderGuideData._fields[gf].name === f.name) {
							f.value = localInput.orderGuideData._fields[gf].value;
							f.displayValue = localInput.orderGuideData._fields[gf].displayValue;
							f.display_value_list = localInput.orderGuideData._fields[gf].display_value_list;
							break;
						}
					}
				}
			}
			if (temp.variable_assignments[item.sys_id]) {
				var cur = temp.variable_assignments[item.sys_id];
				for (var fieldId in cur) {
					var q = GlideappQuestion.getQuestion(fieldId);
					item._fields[q.getName()].value = cur[fieldId];
					
					if (q.getType() == 21 || q.getType() == 8) {
						q.setValue(cur[fieldId]);
						if (q.getType() == 21) {
							var vals = '' + q.getDisplayValues();
							vals = vals.slice(1, -1);
							item._fields[q.getName()].display_value_list = vals.split(', ');
						}
					}
					item._fields[q.getName()].displayValue = q.getDisplayValue();
				}
			}
			data.items.push(item);
		}
		if(temp.conflicting_cart_domain)
			data.conflictingCartDomainMsg = gs.getMessage("Your cart has item(s) belonging to '{0}' domain. To continue to add this item, clear the cart or check out the existing item(s).", temp.conflicting_cart_domain);
		return;
	}
	else if(localInput && localInput.action == "checkout_guide") {
		guideJS = new sn_sc.OrderGuide('' + data.sys_id);
		var cartJS = new sn_sc.CartJS('' + data.sys_id);
		for(var i = 0; i < localInput.guideItems.length; i++)
			guideJS.navigateFromMap(localInput.guideItems[i]);
		cartJS.activateGuide();
		cartJS.setParentParams(localInput.workspaceParams);
		data.result = cartJS.checkoutGuide();
		return;
	}
	else if(localInput && localInput.action == "add_to_cart") {
		var cart = new sn_sc.CartJS();
		guideJS = new sn_sc.OrderGuide('' + localInput.sys_id);
		for(var i = 0; i < localInput.items.length; i++) {
			localInput.items[i].sysparm_cart_name = "";
			guideJS.navigateFromMap(localInput.items[i]);
		}
		if (guideJS.isUseCustomCart())
			new sn_sc.CartJS(localInput.sys_id).empty("");
		cart.activateGuide();
		return;
	}
	else if(localInput && localInput.action == "format_prices") {
		data.frequencySequence = [];
		var gr = new GlideRecord('sys_choice');
		gr.addQuery('name', 'sys_frequency');
		gr.orderBy('sequence');
		gr.query();
		while(gr.next())
			data.frequencySequence.push(gr.label.getDisplayValue());
		var spCurrencyFormatter = new SPCurrencyFormatter();
		data.frequencyMap = {};
		for(var key in localInput.prices)
			data.frequencyMap[key] = spCurrencyFormatter.format(localInput.prices[key]);
		return;
	}
	
	// portal can specify a catalog and category home page
	data.sc_catalog_page = $sp.getDisplayValue("sc_catalog_page") || "sc_home";
	data.sc_category_page = $sp.getDisplayValue("sc_category_page") || "sc_category";
	var catalogID = $sp.getParameter("catalog_id") ? $sp.getParameter("catalog_id") + "" : "-1";
	var m = data.msgs = {};
	m.scHomeMsg = gs.getMessage("Service Catalog");
	m.step1 = gs.getMessage("Describe Needs");
	m.step2 = gs.getMessage("Choose Options");
	m.step3 = gs.getMessage("Summary");
	m.prevMsg = gs.getMessage("Previous");
	m.nextMsg = gs.getMessage("Next");
	m.submitMsg = gs.getMessage("Submit");
	m.orderNowMsg = gs.getMessage("Order Now");
	m.requestMsg = gs.getMessage("Request");
	m.submittedMsg = gs.getMessage("Submitted");
	m.createdMsg = gs.getMessage("Created");
	m.clickMsg = gs.getMessage("click here to view");
	m.dialogTitle = gs.getMessage("Delete Attachment");
	m.dialogMessage = gs.getMessage("Are you sure?");
	m.dialogOK = gs.getMessage("OK");
	m.dialogCancel = gs.getMessage("Cancel");
	m.viewAttachedImage = gs.getMessage("View attached image");
	m.downloadAttachment = gs.getMessage("Download attachment");
	data.maxAttachmentSize = parseInt(gs.getProperty("com.glide.attachment.max_size", 1024));
	if (isNaN(data.maxAttachmentSize))
		data.maxAttachmentSize = 24;
	m.largeAttachmentMsg = gs.getMessage("Attached files must be smaller than {0} - please try again", "" + data.maxAttachmentSize + "MB");
	m.renameSuccessMsg = gs.getMessage("Attachment renamed successfully");
	m.deleteSuccessMsg = gs.getMessage("Attachment deleted successfully");
	m.invalidRecordMsg = gs.getMessage('You are either not authorized or record is not valid.');
	m.delete_attachment = gs.getMessage("Delete Attachment?");
	data.hideDeliveryTime = (options.hide_delivery_time == 'true');
	if (options.sys_id)
		data.sys_id = options.sys_id;
	if (!data.sys_id)
		return;
	var validatedItem = new sn_sc.CatItem('' + data.sys_id);
  if (!validatedItem.canView())
    return;

	data.sys_properties = {
		twostep: gs.getProperty("glide.sc.sp.twostep", "true") == 'true',
		mobileNativeColor: gs.getProperty("glide.sc.mobile.primary_color", "#1f8476"),
		cartEnabled: gs.getProperty("glide.sc.cart.enabled", "false") == "true"
	};
	data.showPrices = $sp.showCatalogPrices();
  data.sc_cat_item = $sp.getGuide(data.sys_id, true, false);
	data.recordFound = true;
	data.readonly_user = gs.hasRole('snc_read_only');
	data.sc_cat_item.native_mobile = options.native_mobile == 'true';

	if (data.sc_cat_item.category) {
		var categoryJS;
		var categoryID = validatedItem.getFirstAccessibleCategoryForSearch((catalogID && catalogID != "-1" ? catalogID : $sp.getCatalogs().value + ""));
		if (GlideStringUtil.isEligibleSysID($sp.getParameter("sysparm_category"))) {
			categoryJS = new sn_sc.CatCategory($sp.getParameter("sysparm_category") + "");
			categoryID = $sp.getParameter("sysparm_category") + "";
		}
		else if (categoryID)
			categoryJS = new sn_sc.CatCategory(categoryID);
		
		if (categoryJS && GlideStringUtil.isEligibleSysID(categoryJS.getID())) {
			data.category = {
				name: categoryJS.getTitle(),
				url: '?id=' + data.sc_category_page + '&sys_id=' + categoryID
			}
			if (categoryJS.getCatalog()) {
				catalogID = categoryJS.getCatalog();
				data.catalog_id = catalogID;
				var catalogObj = new sn_sc.Catalog(catalogID);
				data.sc_catalog = catalogObj.getTitle();
			}
			
			data.categories = [];
			data.categories.push({
				label: categoryJS.getTitle(),
				url: '?id=' + data.sc_category_page + '&sys_id=' + categoryID
			});
			while(categoryJS && categoryJS.getParent()) {
				var parentId =  categoryJS.getParent();
				categoryJS = new sn_sc.CatCategory(parentId);
				var category = {
					label: categoryJS.getTitle(),
					url: '?id=' + data.sc_category_page + '&sys_id=' + parentId
				};
				data.categories.unshift(category);
			}
			if ((($sp.getCatalogs().value + "").split(",")).length > 1) {
				data.all_catalog_msg = gs.getMessage("All Catalogs");
			}
		}
	}
	$sp.logStat('Cat Item View', data.sc_cat_item.sys_class_name, data.sc_cat_item.sys_id, data.sc_cat_item.name, $sp.getPortalRecord().getUniqueValue());
})()]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>organize.fernando</sys_created_by>
        <sys_created_on>2020-06-04 18:15:06</sys_created_on>
        <sys_id>bcea650cdb19d450fa11cf24149619c8</sys_id>
        <sys_mod_count>2</sys_mod_count>
        <sys_name>GService SC Order Guide</sys_name>
        <sys_package display_value="ITSM Service Portal" source="x_gmeps_itsm_servi">334ae627dbc85c105c1163901496192f</sys_package>
        <sys_policy/>
        <sys_scope display_value="ITSM Service Portal">334ae627dbc85c105c1163901496192f</sys_scope>
        <sys_update_name>sp_widget_bcea650cdb19d450fa11cf24149619c8</sys_update_name>
        <sys_updated_by>organize.fernando</sys_updated_by>
        <sys_updated_on>2020-06-04 18:17:40</sys_updated_on>
        <template><![CDATA[<div class="" sn-atf-blacklist="IS_SERVICE_CATALOG">
  <sp-widget widget="orderGuideModal" ng-if="orderGuideModal"></sp-widget>
	<div ng-if="::data.sc_cat_item" class="row">
		<div class="col-sm-12">
			<div ng-class="['panel', 'panel-default', {'order-guide-mobile': {{::data.isMEE}}}]">
				<div ng-class="['timeline-container', {'b-b': {{::!data.isMEE}}}]">
					<div class="wrapper-md break-word" ng-if="::!data.isMEE">
						<h2 class="h2 m-n font-thin" ng-if="::data.sc_cat_item.name">{{::data.sc_cat_item.name}}</h2>
             <div class="text-muted hidden-xs hidden-sm" ng-if="::data.sc_cat_item.short_description">{{::data.sc_cat_item.short_description}}</div>
					</div>
					<div ng-class="['wrapper-xs og-timeline', {'b-t': {{::!data.isMEE}}}]">
						<div class="iconlink col-sm-4 text-a-l pull-left-xs padding-left-xs" ng-class = "{'hidden-xs hidden-sm' : guide_step != 0, 'hidden-lg hidden-md' : (options.compact_mode == 'true' || data.isMEE) && guide_step != 0, 'col-sm-6' : options.compact_mode == 'true' && guide_step == 0}" style="padding-left:61px">
								<div ng-if="::!data.isMEE" class="circle_icon" ng-class="guide_step == 0 ? 'step_active' : 'step_inactive'">
                <i class="fa fa-edit step-icon" style="left: -8px;"/>
              </div>
							<span class="text-muted m-l-sm step-text">{{m.step1}}</span>	
						</div>
						<div class="iconlink col-sm-4 pull-left-xs left-align-xs" ng-class = "{'hidden-xs hidden-sm' : guide_step != 1 , 'hidden-lg hidden-md' : (options.compact_mode == 'true' || data.isMEE) && (guide_step != 1 || isItemOpened), 'col-sm-6' : options.compact_mode == 'true' && guide_step == 1, 'text-a-c': {{ ::!data.isMEE}} }">
              <div ng-if="::!data.isMEE" class="circle_icon" ng-class="guide_step == 1 ? 'step_active' : 'step_inactive'">
                <i class="fa fa-list step-icon"/>
              </div>
							<span class="text-muted m-l-sm step-text">{{m.step2}}</span>
						</div>
						<div class="iconlink col-sm-4 text-a-r left-align-xs" ng-class = "{'pull-left-xs': {{::!data.isMEE}}, 'hidden-xs hidden-sm' : guide_step != 2 , 'hidden-lg hidden-md' : (options.compact_mode == 'true' || data.isMEE) && guide_step != 2, 'col-sm-6' : options.compact_mode == 'true' && guide_step == 2}" style="padding-right:61px">
              <div ng-if="::!data.isMEE" class="circle_icon" ng-class="guide_step == 2 ? 'step_active' : 'step_inactive'">
                <i class="fa fa-check step-icon" style="top: -10px;left: -9px;"/>
              </div>
              <span ng-if="::!data.isMEE" class="text-muted m-l-sm step-text">{{m.step3}}</span>
              <div ng-if="::data.isMEE" class="mobile-summary">
                <span class="text-muted m-l-sm step-text">{{m.step3}}</span>
                <a ng-if="::data.isMEE" ng-disabled="submitted" name="prev" ng-click="goPrev()">${Edit Options}</a>
              </div>
						</div>
					</div>
				</div>
				<div ng-class="{'padder-md padder-t-md': {{::!data.isMEE}}}" ng-if="guide_step == 0">
          <div class="row">
            <div ng-if="::data.sc_cat_item.picture" class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
              <img class="img-responsive catalog-item-image guide-image" ng-src="{{::data.sc_cat_item.picture}}?t=medium" />
            </div>
            <div ng-if="data.sc_cat_item.description" class="col-xs-12 col-sm-12 col-md-9 col-lg-9 break-word">
              <div class="col-md-9 col-lg-9 visible-md visible-lg" ng-class="{false : 'visible-xs visible-sm', true : 'hidden-xs hidden-sm'}[options.show_less_orderguide === 'true']">	
              	<div class="m-t guide-description" ng-bind-html="::data.sc_cat_item.description"></div>
              </div>
              <div class="visible-xs visible-sm col-xs-12 col-sm-12" ng-if="::(options.show_less_orderguide === 'true')">
            		<sc-toggle-data sn-data="::data.sc_cat_item.description"></sc-toggle-data>
            	</div>
            </div>
	        </div>
					<div class="wrapper-md" ng-class="data.sc_cat_item.picture || data.sc_cat_item.description ? 'b-t' : ''">
						<sp-model form-model="data.sc_cat_item" mandatory="data.sc_cat_item._mandatory"></sp-model>
					</div>
				</div>
				<div ng-if="guide_step == 1">
          <div ng-if="evaluatingIncludes" class="include-loader">
            <i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>
						<span class="sr-only">${Loading...}</span>
          </div>
					<div class="remove-margin-bottom-xs" ng-if="includedItems.length">
						<div ng-class="::data.isMEE ? 'list-group-mobile' : 'list-group'">
            <div ng-if="::!data.isMEE" class="pull-right text-xs"><i class="fa fa-asterisk mandatory"></i> <span class="text-muted">${Mandatory Fields}</span></div>
						<div ng-class="['m-b-lg', '{{::!data.isMEE ? 'font-bold' : 'm-l-sm'}}']">${Included Items: }</div>
             <uib-accordion close-others="true">
							<uib-accordion-group
                                   ng-class="['accordion-header', {'b': !data.isMEE , 'disable-row': !item.included }]"
                                   template-url="group-template.html"
                                   ng-init="initAttachmentCallbacks($index);"
                                   ng-repeat="item in includedItems track by item.sys_id | orderBy: 'order'"
                                   id="{{::item.sys_id}}"
                                   is-open="item.isOpen">
                <uib-accordion-heading>
                  <div class="row" ng-class="{'b-b': {{ ::data.isMEE }} }" ng-click="showCancel(item.sys_id)"> 
                    <div class="col-sm-2 col-xs-2" ng-if="::data.isMEE && showIncludeToggle">	
                      <label class="og-check-bucket" ng-click="$event.stopPropagation()" >
                        <input type="checkbox"
                               ng-model="item.included"
                               tabindex="0"
                               aria-label="${Included}"
                               id="enable_switch_{{::item.sys_id}}"  />
                        <span class="og-check" ng-click="toggleItemState(item)" for="enable_switch_{{::item.sys_id}}" />
                      </label>
                    </div>
                    <div class="align-text" ng-class="::data.isMEE ? 'col-xs-10 col-sm-10 og-mobile-item' : 'col-md-3 col-lg-3 col-xs-12 col-sm-12 font-bold'" id="item_name_{{::item.sys_id}}">
                      <img ng-if="::item.icon && !data.isMEE" ng-src="{{::item.icon}}" class="item-icon pad-right hidden-xs hidden-sm"/>
                      <span aria-role="heading" aria-level="3" ng-class="::data.isMEE ? 'item-name' : 'break-word'">
                        <i class="fa fa-asterisk mandatory" ng-if="data.isMEE && (item._mandatory.length ||  (item.mandatory_attachment && !item.attachment_submitted)) && item.included"></i>
                        {{::item.name}}
                      </span>
                      <label class="visible-sm-inline-block visible-xs-inline-block options m-l-xs pull-right-xs" ng-class="{'visible-md-inline-block visible-lg-inline-block': {{ ::data.isMEE }}}">
                        <span ng-if="::data.isMEE && (item._sections.length > 0 || item.mandatory_attachment)">${Options}</span>
                        <span class="fa accordion-icon" ng-class="{'hidden-md hidden-lg': {{ ::!data.isMEE }} }" ng-if="item.included" title="{{item.isOpen ?'${Collapse}':'${Expand}'}}" aria-hidden="true"></span>
                      </label>
                    </div>
                    <div ng-if="::!data.isMEE" class="col-md-6 col-lg-6 hidden-xs hidden-sm align-text break-word" aria-hidden="true">
                      {{::item.short_description}}
                    </div>
                    <div ng-if="::!data.isMEE" class="col-md-3 col-lg-3 col-xs-12 col-sm-12 text-a-r pull-left-xs left-align-xs align-text" ng-class="{'og-switch': {{ ::!data.isMEE }} }"> 
                      <span class="hidden-sm hidden-xs pull-left options" ng-if="::item._sections.length > 0 || item.mandatory_attachment"> 
                        <i class="fa fa-asterisk mandatory" ng-if="(item._mandatory.length ||  (item.mandatory_attachment && !item.attachment_submitted)) && item.included"></i>
                        <i class="m-l-sm" ng-if="!(item._mandatory.length ||  (item.mandatory_attachment && !item.attachment_submitted)) || !item.included"></i>
                        ${Options}
                      </span>
                      <div class="inline" ng-if="::!data.isMEE && showIncludeToggle">	
                        <div class="input-switch inline v-middle m-l" ng-click="$event.stopPropagation()" uib-tooltip="{{item.included ? '${Included}' : '${Not Included}'}}" tooltip-placement="top" tooltip-append-to-body="true" role="none">
                          <input type="checkbox"
                                 ng-model="item.included"
                                 tabindex="0"
                                 aria-label="${Included}"
                                 id="enable_switch_{{::item.sys_id}}"  />
                          <label class="switch" for="enable_switch_{{::item.sys_id}}" ng-click="toggleItemState(item)"></label>
                        </div>
                      </div>
                      <span class="visible-sm-inline-block visible-xs-inline-block options m-l-lg" ng-if="::!data.isMEE && (item._sections.length > 0 || item.mandatory_attachment)"> 
                        <i class="fa fa-asterisk mandatory" ng-if="(item._mandatory.length ||  (item.mandatory_attachment && !item.attachment_submitted)) && item.included"></i>
                        <i class="m-l-sm" ng-if="!(item._mandatory.length ||  (item.mandatory_attachment && !item.attachment_submitted)) || !item.included"></i>
                        ${Options}
                      </span>
                      <span class="fa accordion-icon hidden-xs hidden-sm" ng-class="item.isOpen ? 'fa-chevron-up' : 'fa-chevron-down'" title="{{item.isOpen ?'${Collapse}':'${Expand}'}}" aria-hidden="true"></span>
                    </div>
                  </div>
                </uib-accordion-heading>
								<div id="item_details_{{::item.sys_id}}" role="region" aria-labelledby="{{::item.sys_id}}" sp-pause-child-watchers-if-hidden>
                  <div class="wrapper" ng-class="::data.isMEE ? 'guide-item-details-wrapper-mobile' : 'guide-item-details-wrapper'">
                    <div class="panel-body">
                      <div class="row m-b-lg">
                        <div class="col-xs-12 col-sm-12 hidden-md hidden-lg padder-b break-word" ng-class="{'title-mobile' : {{ ::data.isMEE}} }" aria-hidden="true">
                      		{{::item.short_description}}
                          <div ng-if="::!data.isMEE" class="font-normal pull-right m-r-sm hidden-md hidden-lg">
                            <span class="" ng-if="data.showPrices && item.price">{{item.price_display}} {{item.recurring_price ? '+' : ''}}</span> <span class="" ng-if="data.showPrices && item.recurring_price"> {{item.recurring_price_display}} {{item.recurring_price_frequency}}</span>
                            <div class="" ng-if="!data.hideDeliveryTime && item.sys_class_name != 'sc_cat_item_producer' && item.sys_class_name != 'sc_cat_item_guide' && (!item.no_delivery_time && item.estimated_delivery_time)">{{::item.estimated_delivery_time}} ${Delivery}</div>                          
                          </div>
                        </div>
                        <div class="col-lg-3 col-md-3 hidden-xs hidden-sm" ng-if="::item.picture">
                          <img ng-if="::item.picture" class="img-responsive catalog-item-image guide-item-image" ng-src="{{::item.picture}}" />  
                        </div>
                        <div class="col-lg-9 col-md-9 col-xs-12 col-sm-12">
                          <div ng-if="::!data.isMEE" class="font-normal pull-right m-r-sm hidden-xs hidden-sm">
                            <span class="" ng-if="data.showPrices && item.price">{{item.price_display}} {{item.recurring_price ? '+' : ''}}</span> <span class="" ng-if="data.showPrices && item.recurring_price"> {{item.recurring_price_display}} {{item.recurring_price_frequency}}</span>
                            <div class="" ng-if="!data.hideDeliveryTime && item.sys_class_name != 'sc_cat_item_producer' && item.sys_class_name != 'sc_cat_item_guide' && (!item.no_delivery_time && item.estimated_delivery_time)">{{::item.estimated_delivery_time}} ${Delivery}</div>
                          </div>
                          <img ng-if="::item.picture" class="img-responsive catalog-item-image hidden-lg hidden-md" ng-class="{'guide-item-image-xs': {{::!data.isMEE }} }" ng-src="{{::item.picture}}" />  
                          <div ng-if="::item.description" class="m-t guide-description clearfix visible-md visible-lg break-word" ng-bind-html="::item.description" ng-class="::{false : 'visible-xs visible-sm', true : 'hidden-xs hidden-sm'}[options.show_less_orderguide === 'true']"></div>
                          <div class="visible-xs visible-sm break-word" ng-if="::(options.show_less_orderguide === 'true')">
                            <sc-toggle-data sn-data="::item.description"></sc-toggle-data>
                          </div>
                        </div>
                      </div>
                      <fieldset ng-class="{'disabled-mask': !item.included}"></fieldset>
                      <sp-cat-item item="item" />
                      <sp-model form-model="item" mandatory="item._mandatory"></sp-model>
                      <div>
                        <div ng-if="item.attachments.length" class="file-list-wrap">
                          <ul class="list-group" style="margin-bottom: 0; padding:0">
                            <li class="list-group-item" ng-repeat="attachment in item.attachments">
                              <div class="sp-attachment-block-single-line file-attachment row" id="{{::attachment.sys_id}}">
                                <a aria-label="{{::(attachment.thumbSrc ? m.viewAttachedImage : m.downloadAttachment)}}" tabindex="0" class="col-md-1 col-sm-1 col-xs-2 view-attachment m-b-none text-center" style="border: none;"
                                   ng-click="item.attachmentHandler.viewAttachment($event, attachment)" href="javascript:void(0)" title="View" >
                                  <img alt="" ng-if="attachment.thumbSrc" class="attachment-thumbnail img-responsive" ng-src="{{attachment.thumbSrc}}"/>
                                  <span ng-if="::!attachment.thumbSrc">
                                    <span class="glyphicon glyphicon-file text-2x"/>
                                  </span>
                                </a>
                                <div class="col-md-9 col-sm-8 col-xs-7 file-name v-middle">
                                  <a tabindex="0" class="get-attachment" ng-click="item.attachmentHandler.downloadAttachment(attachment)" ng-attr-title="${Download} {{::attachment.file_name}}" href="javascript:void(0)">
                                    {{::attachment.file_name}} ({{::attachment.size}})
                                  </a>
                                  <input tabindex="-1" ng-keydown="item.attachmentHandler.onKeyDown($event, attachment)" ng-blur="item.attachmentHandler.updateAttachment($event, attachment)" style="display: none;"/>
                                  <div>
                                    <time><sn-time-ago timestamp="::attachment.sys_updated_on" /></time>
                                  </div>
                                </div>
                                <div class="col-md-2 col-sm-3 col-xs-3 tools v-middle align-right">
                                  <div class="btn-group" ng-if="::(attachment.canWrite || attachment.canDelete)">
                                    <button type="button" tabindex="0" class="btn btn-default btn-clear" ng-click="item.attachmentHandler.editAttachment($event, attachment)" title="${Edit file name}" aria-label="${Edit file name}"><i class="fa fa-pencil" aria-hidden="true"></i></button>
                                    <button type="button" tabindex="0" class="btn btn-default btn-clear" ng-click="item.confirmDeleteAttachment(attachment, $event)" title="${Delete}" aria-label="${Delete}"><i class="fa fa-times" aria-hidden="true"></i></button>
                                  </div>
                                </div>
                              </div>
                            </li>
                          </ul>
                          <div class="errors-wrap" ng-hide="errorMessages.length == 0">
                            <div class="error-msg icon-cross" ng-repeat="error in errorMessages" ng-click="item.attachmentHandler.dismissMsg($event, $index, errorMessages)">
                              <span>{{error.msg}}</span>
                              <span class="file-name">{{error.fileName}}</span>
                            </div>
                          </div>
                        </div>
                        <div ng-class="{'mobile-attachment-label' : {{::data.isMEE}} }">
                          <label ng-if="!submitted && !item.no_attachments" ng-class="{'attachment-label' : {{::!data.isMEE}} }">
                            <span class="file-upload-input">
                              <input type="file" style="display: none" multiple="true" ng-file-select="item.attachmentHandler.onFileSelect($files)" class="sp-attachments-input"/>
                              <button title="" ng-click="item.attachmentHandler.openSelector($event)" class="panel-button sp-attachment-add btn btn-link" aria-label="${Add attachment}"><span class="glyphicon glyphicon-paperclip"></span></button>
                            </span>
                            <span class="fa fa-asterisk mandatory" 
                                  ng-if="item.mandatory_attachment && item.included" 
                                  ng-class="{'mandatory-filled': item.mandatory_attachment && item.attachment_submitted}"
                                  style="vertical-align:super"></span>
                            <span class="add-attachment-content">${Add attachments}</span>
                          </label>
                        </div>
                      </div>
                      <div ng-if="::data.isMEE" class="font-normal og-item-price">
                        <strong class="" ng-if="data.showPrices && item.price">{{item.price_display}}</strong>
                        <span class="" ng-if="data.showPrices && item.recurring_price"> + {{item.recurring_price_display}} {{item.recurring_price_frequency}}</span>
                        <label class="" ng-if="!data.hideDeliveryTime && item.sys_class_name != 'sc_cat_item_producer' && item.sys_class_name != 'sc_cat_item_guide' && (!item.no_delivery_time && item.estimated_delivery_time)">{{::item.estimated_delivery_time}} ${Delivery}</label>
                      </div>
										</div>
									</div>
								</div>
              </uib-accordion-group>
            </uib-accordion>
						</div>
					</div>
					<div class="empty-state-content" ng-if="includedItems.length == 0 && !evaluatingIncludes">
            			<h3>${Order Guide has no items to order}</h3>
          			</div>
				</div>
				<div ng-if="guide_step == 2">
					<div ng-class="::data.isMEE ? 'list-group-mobile' : 'list-group'">
            <section ng-if="::data.isMEE" class="summary">
							<label class="m-b-lg m-l-sm">${Order Guide Details}</label>
							<section ng-repeat="item in ::includedItems track by item.sys_id| orderBy: 'order'" ng-class="::['b-b' ,{'summary-excluded': !item.included}]">
                <div class="wrapper-cart-xs guide-item">
                  <label class="guide-item-quantity">{{::item.quantity}} </label>
									<div class="guide-item-name">
                    <span class="wrap-word">{{::item.name}}</span>
                    <div>
                      <span>{{::(data.showPrices && item.price && item.price_subtotal ? item.price_subtotal_display : '')}}</span>
                      <span>{{::(data.showPrices && item.recurring_price && item.recurring_price_subtotal ? " +" + item.recurring_price_subtotal_display : '')}}</span>
                      <span ng-if="::(data.showPrices && item.recurring_price && item.recurring_price_frequency)" style="font-size:10px">{{::item.recurring_price_frequency}}</span>
                    </div>
                  </div>
                </div>
                <label ng-if="::!item.included" class="wrapper-xs not-included not-included-pill">${NOT INCLUDED}</label>
              </section>
						</section>
            
						<table ng-if="::!data.isMEE" class="table table-striped m-b-sm light-border-bottom summary add-margin-bottom-xs" summary="${Summary of the guide}">
							<thead>
								<tr>
									<th class="wrapper-sm wrapper-cart-xs col-md-5 col-lg-5 col-xs-8 col-sm-8 border-bottom-xs" scope="col">${Order Guide Details}</th>
									<th class="wrapper-sm col-md-1 col-lg-1 text-a-c hidden-xs hidden-sm" scope="col">${Quantity}</th>
									<th class="wrapper-sm col-md-2 col-lg-2 text-a-c hidden-xs hidden-sm" scope="col">${Price} (${ea.})</th>
									<th class="wrapper-sm col-md-2 col-lg-2 text-a-c hidden-xs hidden-sm" scope="col">${Recurring} (${ea.})</th>
                  <th class="wrapper-sm wrapper-cart-xs col-md-2 col-lg-2 col-xs-4 col-sm-4 border-bottom-xs" scope="col" ng-hide="totalIncluded == includedItems.length" style="width:12%"></th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="item in ::includedItems track by item.sys_id| orderBy: 'order'" ng-class="::{'summary-excluded': !item.included}">
									<td class="wrapper-sm v-middle wrapper-cart-xs border-top-xs">
                    <span class="hidden-md hidden-lg">{{::item.quantity}} </span>
										<span class="wrap-word">{{::item.name}}</span>
									</td>
									<td class="wrapper-sm v-middle text-a-c hidden-xs hidden-sm">
										<span>{{::(!item.no_quantity? item.quantity : '---')}}</span>
									</td>
									<td class="wrapper-sm v-middle text-a-c hidden-xs hidden-sm">
										<span><strong>{{::(data.showPrices && item.price && item.price_subtotal ? item.price_subtotal_display : '---')}}</strong></span>
									</td>
									<td class="wrapper-sm v-middle text-a-c hidden-xs hidden-sm">
										<span class="clearfix"><strong>{{::(data.showPrices && item.recurring_price && item.recurring_price_subtotal ? item.recurring_price_subtotal_display : '---')}}</strong></span>
										<span ng-if="::(data.showPrices && item.recurring_price && item.recurring_price_frequency)" style="font-size:10px">{{::item.recurring_price_frequency}}</span>
									</td>
                  <td class="wrapper-sm v-middle text-a-r wrapper-cart-xs border-top-xs" ng-hide="::(totalIncluded == includedItems.length)">
										<span ng-if="::!item.included" class="wrapper-xs not-included not-included-pill">${NOT INCLUDED}</span>
									</td>
								</tr>
							</tbody>
						</table>            
            <div class="padder-v clearfix hidden-xs hidden-sm hidden-md" ng-if="::!data.isMEE" style="padding-top: 25px !important">
              <div  class="pull-right">
                <button ng-disabled="submitted" name="add_to_cart" ng-click="triggerAddToCart()" class="btn btn-default m-r m-l m-r-6" ng-if="showAddToCart">${Add to Cart}</button>
                <button ng-disabled="submitted" name="prev" ng-click="goPrev()" class="btn btn-default m-r m-r-6">${Edit Options}</button>
                <button ng-disabled="submitted" name="order" ng-click="triggerSubmit()" class="btn btn-primary" sn-focus="guide_step == 2">{{::submitButtonMsg}}</button>
              </div>
						<div class="pull-right m-r-lg m-l wrapper-sm" ng-if="data.showPrices" style="top: -10px;position: relative;">
								<div class="pull-left"><strong>${Total} : </strong>
								</div>
								<div class="pull-left m-l-xs">
									<div><strong> {{price_display}}</strong>
									</div>
									<div ng-repeat="freq in ::frequencySequence">
										<span class="clearfix" ng-if="frequencyMap.hasOwnProperty(freq)" style="font-size:13px"> + {{(frequencyMap[freq] + ' ' + freq)}}</span>
									</div>
								</div>
							</div>
						</div>
            
            <div class="clearfix visible-xs visible-sm visible-md">
              <div class="m-r-lg m-b-sm" ng-class="'{{::data.isMEE ? 'pull-right m-t-sm' : 'pull-left'}}'" ng-if="::data.showPrices">
								<div class="pull-left"><strong>${Total : }</strong>
								</div>
								<div class="pull-left m-l-xs">
									<div><strong> {{price_display}}</strong>
									<div ng-repeat="freq in ::frequencySequence">
										<span class="clearfix" ng-if="frequencyMap.hasOwnProperty(freq)" style="font-size:13px"> + {{(frequencyMap[freq] + ' ' + freq)}}</span>
									</div>
									</div>
								</div>
							</div>
            	<button ng-disabled="submitted" name="add_to_cart" ng-click="triggerAddToCart()" class="btn btn-default m-b-sm col-xs-12" ng-if="::!data.isMEE && showAddToCart">
                  ${Add to Cart}</button>
              <button ng-if="::!data.isMEE"  ng-disabled="submitted" name="prev" ng-click="goPrev()" class="btn btn-default m-b-sm col-xs-12">
                  ${Edit Options}</button>
              <button ng-if="::!data.isMEE" ng-disabled="submitted" name="order" ng-click="triggerSubmit()" class="btn btn-primary col-xs-12" sn-focus="guide_step == 2">
                  {{::submitButtonMsg}}</button>
            </div>
            
					</div>
				</div>
				<div ng-if="::!data.isMEE && !data.readonly_user" class="guide-nav" ng-hide="evaluatingIncludes || guide_step == 2" ng-class="{'guide-nav-setp1': guide_step == 1}">
          <div class="pull-right">
            <button ng-hide="guide_step != 1 || submitted" name="submit" ng-click="goPrev()" class="btn btn-default padder pull-left-xs" ng-class="{'m-r-6': guide_step < 2}">{{::m.prevMsg}}</button>
            <button id="submit" ng-hide="guide_step > 1" ng-disabled="submitted || data.sc_cat_item._mandatory.length > 0 || (totalIncluded <= 0 && guide_step != 0)" name="submit" ng-click="goNext()" class="btn btn-primary padder-lg" sn-focus="guide_step < 2">{{::m.nextMsg}}</button>
            <span ng-if="validating" style="padding-left:4px">${Validating...}</span>
          </div>
				</div>
			</div>
		</div>
	</div>
	<div ng-if="::!data.sc_cat_item">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h4 class="panel-title">${Item not found}</h4>
			</div>
			<div class="panel-body wrapper">
				<p>${This item is not found or currently not available}</p>
				<p>${Suggestions}:</p>
				<ul>
					<li>${Try searching for the item}</li>
					<li>${Go to the Service Catalog homepage}</li>
				</ul>
			</div>
		</div>
	</div>
</div>
<div ng-if="::!data.recordFound" class="alert alert-info">{{::m.invalidRecordMsg}}</div>
<now-message key="Items have been added successfully" value="${Items have been added successfully}"/>
<now-message key="Items have been added successfully to your cart" value="${Items have been added successfully to your cart}"/>
<now-message key="Add to Cart" value="${Add to Cart}"/>
<now-message key="Catalog Home" value="${Catalog Home}"/>
<now-message key="View Cart" value="${View Cart}"/>
<now-message key="Attachment(s) are not added" value="${Attachment(s) are not added}"/>
<now-message key="Please wait, attachment deletion in progress" value="${Please wait, attachment deletion in progress}"/>
<now-message key="Leave page?" value="${Leave page?}"/>
<now-message key="Changes you made will be lost." value="${Changes you made will be lost.}"/>
<now-message key="Cancel" value="${Cancel}"/>
<now-message key="Leave" value="${Leave}"/>
<now-message key="Done" value="${Done}"/>

<script type="text/ng-template" id="group-template.html">
   <div>
    <div class="panel-heading">
      <div class="panel-title">
        <div tabindex="0" class="accordion-toggle" ng-click="toggleOpen()" uib-accordion-transclude="heading" role="none">
          <span uib-accordion-header>
          </span>
        </div>
  		</div>
  	</div>
    <div class="panel-collapse collapse" uib-collapse="!isOpen">
      <div ng-transclude></div>
  	</div>
  </div>
  </script>]]></template>
    </sp_widget>
    <sys_update_version action="INSERT_OR_UPDATE">
        <action>DELETE</action>
        <application display_value="ITSM Service Portal">334ae627dbc85c105c1163901496192f</application>
        <file_path/>
        <instance_id>cf5b95b4dba4bb0007072f17d496195a</instance_id>
        <instance_name>globosatdev</instance_name>
        <name>sp_widget_bcea650cdb19d450fa11cf24149619c8</name>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sp_widget"&gt;&lt;sp_widget action="INSERT_OR_UPDATE"&gt;&lt;category&gt;custom&lt;/category&gt;&lt;client_script&gt;&lt;![CDATA[function ($scope, $http, nowServer, $timeout, spUtil, spScUtil, spModal, i18n, $window, $location, spAriaUtil, nowAttachmentHandler, $log, $sce, $q, spAtf, spSCNavStateManager, cabrillo) {
	var c = this;
	$scope.guide_step = 0;
	$scope.m = $scope.data.msgs;
	$scope.evaluatingIncludes = false;
	$scope.data.isMEE = cabrillo.isNative() &amp;&amp; $scope.options.native_mobile == 'true';
	$scope.isItemOpened = false;
	var webAnalyticsMsgSuffix = $scope.data.isMEE ? " -NOW Mobile" : "";
	includedGformInstances = {};
	
	$rootScope.$on('spModel.gForm.rendered', function() {
		if ($scope.guide_step === 0) {
			addCabrilloBottomButtons({
				title: [$scope.data.msgs.nextMsg],
				fn: [$scope.goNext]
			});
		}
		$timeout(function() {
			spAtf.init().then(function(atf) {
				$scope._atf = atf;
				atf.expose('catalog_util', catalogUtil);
			});
		}, 10);
	});
	
	if ($scope.options.isServiceWorkspace &amp;&amp; $window.frameElement) {
		var workspaceParams = {};
		workspaceParams.sysparm_parent_table = $window.frameElement.getAttribute('parent-table');
		workspaceParams.sysparm_parent_sys_id = $window.frameElement.getAttribute('parent-sys-id');
		$scope.data.workspaceParams = workspaceParams;
	}
	
	if ($scope.data.sc_cat_item) {
		$scope.data.sc_cat_item.description = $sce.trustAsHtml($scope.data.sc_cat_item.description);

		if ($scope.data.sc_cat_item.request_method == "request")
			$scope.submitButtonMsg = $scope.m.requestMsg;
		else if ($scope.data.sc_cat_item.request_method == "submit")
			$scope.submitButtonMsg = $scope.m.submitMsg;
		else
			$scope.submitButtonMsg = $scope.m.orderNowMsg;

		// Breadcrumbs
		if (!$scope.data.categories)
			$scope.data.categories = [];
		$scope.data.categories.forEach(function(category, index, categories){
			categories[index].url = category.url + '&amp;catalog_id=' + $scope.data.catalog_id;
		});
		if ($scope.data.categories.length &gt; 0) {
			$scope.data.categories.unshift({label: $scope.data.sc_catalog || $scope.page.title, url: '?id=' + $scope.data.sc_category_page});
			$scope.data.categories.push({label: $scope.data.sc_cat_item.name, url: '#'});
			if ($scope.data.all_catalog_msg) {
				$scope.data.categories.unshift({label: $scope.data.all_catalog_msg, url: '?id=' + $scope.data.sc_category_page + "&amp;catalog_id=-1"});
			}
		}
		else {
			$scope.data.categories.push({label: $scope.data.sc_cat_item.name, url: '#'});
		}

		$timeout(function() {
			$scope.$emit('sp.update.breadcrumbs', $scope.data.categories);
		});
		spUtil.setSearchPage('sc');
	} else {
		var notFoundBC = [{label: $scope.page.title, url: '?id=' + $scope.data.sc_catalog_page}];
		$timeout(function() {
			$scope.$emit('sp.update.breadcrumbs', notFoundBC);
		});
		spUtil.setSearchPage('sc');
	}

	function isValidItemGform(g_form) {
		if (g_form.getSysId() === $scope.data.sc_cat_item.sys_id)
			return true;
		if ($scope.includedItems)
			for (var i in $scope.includedItems)
				if ($scope.includedItems[i].sys_id === g_form.getSysId())
					return true;
		return false;
	}


	$scope.$on('spModel.gForm.initialized', function(e, gFormInstance) {
		if (!isValidItemGform(gFormInstance))
			return;
		includedGformInstances[gFormInstance.getSysId()] = gFormInstance;
		spSCNavStateManager.register(gFormInstance);
		spSCNavStateManager.isNative($scope.data.isMEE);
		gFormInstance.$private.events.on('submitted', function(event) {
			gFormInstance.$private.processed = true;
			if (gFormInstance.getSysId() == $scope.data.sc_cat_item.sys_id) {
				$scope.$broadcast('$sp.service_catalog.form_submitted', {action_name: 'submit'});
				$scope.guide_step = 1;
				evalIncludes();
				spSCNavStateManager.unregisterForms(Object.keys(includedGformInstances));
				$scope.itemShown = 0;
			}
			else
				processChooseOptions();
		});

		if ($scope.data.isMEE) {
			cabrillo.viewLayout.showSpinner();
			cabrillo.viewLayout.setTitle($scope.data.sc_cat_item.name);
			$rootScope.$on('spModel.gForm.showNativeMobileButtons', function() {
				cabrillo.viewLayout.setTitle($scope.data.sc_cat_item.name);
				showCabrilloBottomButtons();
			});
		}
		$timeout(function() {
			$rootScope.$emit('spModel.gForm.rendered');
			if ($scope.data.isMEE) {
				cabrillo.viewLayout.hideSpinner();
			}
		}, 175);
	});

	$scope.$on('spModel.gForm.destroyed', function(e, sys_id){
		delete includedGformInstances[sys_id];
	});

	var validationComplete = $rootScope.$on('$sp.service_catalog.form_validation_complete', function() { $scope.validating = false; });

	
	/*************************************************************************************************/
	/********************************       Guide Navigation Start     *******************************/
	/*****#####################################################################################********/
	
	$scope.goPrev = function() {
		if ($scope.submitted)
			return;

		clearCabrilloBottomButtons();
		$scope.includedItems.forEach(function (item) {
			item.isOpen = false;
		})
		$scope.guide_step--;
		if($scope.guide_step==0)
			spSCNavStateManager.unregisterForms(Object.keys(includedGformInstances));

		if ($scope.guide_step === 1) {
			addCabrilloBottomButtons({
				title: [$scope.data.msgs.prevMsg, $scope.data.msgs.nextMsg],
				fn: [$scope.goPrev, $scope.goNext]
			});
		}
	}
	
	$scope.goNext = function(timeout) {
		var gForm;
		if($scope.guide_step == 0) {
			$scope.$evalAsync(function () {
				gForm = includedGformInstances[$scope.data.sys_id];
				if (!spScUtil.isRegexDone($scope.data.sc_cat_item._fields))
					$scope.validating = true;
				else if (gForm &amp;&amp; !gForm.submit()) {
					timeout = timeout || 2000;
					if ($scope.data.isMEE)
						openItemWithInvalidFields();
					$timeout(function () {
						$scope.$broadcast('$sp.service_catalog.form_submit_failed', {action_name: 'submit'});
					}, timeout);
				}
			});
		}
		else if($scope.guide_step == 1) {
			$scope.itemsIncluded = $scope.includedItems.length;
			$scope.includedItemsCounter = 0;
			$scope.$evalAsync(function () {
				for (var i = 0; i &lt; $scope.includedItems.length; i++) {
					if ($scope.includedItems[i].included) {
						$scope.includedItemsCounter++;
						var g_form = includedGformInstances[$scope.includedItems[i].sys_id];
						g_form.$private.processed = false;
						if (!spScUtil.isRegexDone($scope.includedItems[i]._fields))
							$scope.validating = true;
						else if (g_form &amp;&amp; !g_form.submit()) {
							timeout = timeout || 500;
							$timeout(function () {
								$scope.$broadcast('$sp.service_catalog.form_submit_failed', {action_name: 'submit'});
								openItemWithInvalidFields();
							}, timeout);   
						}
					}
					else
						$scope.itemsIncluded--;
				}
			});
		}
	}
	
	$scope.toggleItemState = function(item) {
		if(item.included) {
			$scope.totalIncluded--;
			angular.element('#item_details_' + item.sys_id).find('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]').attr('tabindex', -1);
		}
		else {
			$scope.totalIncluded++;
			angular.element('#item_details_' + item.sys_id).find('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]').removeAttr('tabindex');
		}
	}

	function processChooseOptions() {
		var canSubmit = true;

		for (var i = 0; i &lt; $scope.includedItems.length; i++) {
			if ($scope.includedItems[i].included) {
				var gForm = includedGformInstances[$scope.includedItems[i].sys_id];
				if (gForm &amp;&amp; !gForm.$private.processed) {
					canSubmit = false;
					break;
				}
			}
		}
		if(canSubmit) {
			evalGuidePrice();
			spSCNavStateManager.unregisterForms(Object.keys(includedGformInstances));
			$scope.$broadcast('$sp.service_catalog.form_submitted', {action_name: 'submit'});
			$scope.guide_step = 2;
			$scope.showAddToCart = $scope.options.show_add_cart_button == 'true' &amp;&amp; !$scope.data.sc_cat_item.no_cart;
			addCabrilloBottomButtons({
				title: [i18n.getMessage('Add to Cart'), $scope.submitButtonMsg],
				fn: [$scope.triggerAddToCart, $scope.triggerSubmit]
			});
		}
	}

	var openItemWithInvalidFields = (function(){
		var formsValidated = 0;
		return function() {
			formsValidated++;
			if (formsValidated == $scope.itemsIncluded) {			
				var someFormIsInvalid = false;
				for (var i=0; i &lt; $scope.includedItems.length; i++) {
					if ($scope.includedItems[i].included) {
						var gForm = includedGformInstances[$scope.includedItems[i].sys_id];
						if (!gForm)
							return;
						
						var fields = gForm.getFieldNames();
						for (var j=0; j&lt;fields.length; j++) {
							var field = gForm.getField(fields[j]);
							if (field.isInvalid) {
								if ($scope.data.isMEE) {
									$scope.includedItems[i].isOpen = true;
									$scope.showCancel($scope.includedItems[i].sys_id);
								}
								else
									$scope.includedItems[i].isOpen = true;

								someFormIsInvalid = true;
								break;
							}					
						}
						if ($scope.data.isMEE &amp;&amp; someFormIsInvalid)
							break;
					}
				}
				formsValidated = 0;		
				if (!$scope.data.isMEE)
					focusInvalidField();	
			}
		}
	})();

	function focusInvalidField(){     
		$timeout(function() {
			for (var i = 0; i &lt; $scope.includedItems.length; i++) {
				if ($scope.includedItems[i].included) {
					var mandatory = $scope.includedItems[i]._mandatory;
					if (mandatory &amp;&amp; mandatory.length &gt; 0) {
						var elems = angular.element("[name*='" + mandatory[0].name + "']");
						if (elems &amp;&amp; elems.length &gt; 0) //set focus the first element
							elems[0].focus();
						break;
					} else {
						var gForm = includedGformInstances[$scope.includedItems[i].sys_id];
						getInvalidFields(gForm);
						var invalidFields = gForm._invalidFields;
						if (invalidFields &amp;&amp; invalidFields.length &gt; 0) {
							var invalid = angular.element("[name*='" + invalidFields[0].name + "']");
							if (invalid &amp;&amp; invalid.length &gt; 0) //set focus the first element
								invalid[0].focus();
							break;
						}
					}
				}
			}
		}, 500);
	}
	
	$scope.closeItemAccordion = function (itemOpened) {
		itemOpened.isOpen = false;
		cabrillo.viewLayout.setNavigationBarButtons();
		cabrillo.viewLayout.setTitle($scope.data.sc_cat_item.name);
		addCabrilloBottomButtons({
			title: [$scope.data.msgs.prevMsg, $scope.data.msgs.nextMsg],
			fn: [$scope.goPrev, $scope.goNext]
		});
		$scope.isItemOpened = false;
	}
	
	$scope.showItem = function(index) {
		if($scope.itemShown == index)
			$scope.itemShown = -1;
		else
			$scope.itemShown = index;
	}

	$scope.showCancel = function(id) {
		var itemOpened, buttons;
		if ($scope.data.isMEE) {
			clearCabrilloBottomButtons();
			cabrillo.viewLayout.setNavigationBarButtons();
			cabrillo.viewLayout.hideBackButton();
			itemOpened = $scope.includedItems.find(function (item) {
				return item.sys_id === id;
			});

			cabrillo.viewLayout.setTitle(itemOpened.name);
			buttons = [
				{
					title: i18n.getMessage('Done'),
					enabled: true
				}
			];

			cabrillo.viewLayout.setNavigationBarButtons(buttons, function(index) {
				$scope.closeItemAccordion(itemOpened);
			});
		}
		$scope.isItemOpened = true;
	}
	
	/********************************************************************************************/
	/********************************     Guide Navigation End    *******************************/
	/*****###############################################################################********/
	/********************************************************************************************/
	/********************************         Attachments         *******************************/
	/*****###############################################################################********/
	
	function initAttachmentHandlers() {
		var setAttachments;
		var appendError = function (error) {
			spUtil.addErrorMessage(error.msg + error.fileName);
		};
		for (var i = 0; i &lt; $scope.includedItems.length; i++) {
			$scope.includedItems[i].attachmentHandler = new nowAttachmentHandler(setAttachments, appendError);
			$scope.includedItems[i].attachmentHandler.setParams($scope.includedItems[i].targetTable, $scope.includedItems[i].sysparm_item_guid, 1024 * 1024 * $scope.data.maxAttachmentSize);
		}
	}
	
	$scope.$on('dialog.upload_too_large.show', function(e){
		$log.error($scope.m.largeAttachmentMsg);
		spUtil.addErrorMessage($scope.m.largeAttachmentMsg);
	});

	$scope.initAttachmentCallbacks = function (itemIndex) {
		$scope.includedItems[itemIndex].attachmentHandler.setAttachments = function (attachments, action) {
			$scope.includedItems[itemIndex].attachments = attachments;
			if (action === "added") {
				$scope.includedItems[itemIndex].attachment_submitted = true;
			}
			if (action === "renamed")
				spAriaUtil.sendLiveMessage($scope.m.renameSuccessMsg);
			if (action === "deleted") {
				spAriaUtil.sendLiveMessage($scope.m.deleteSuccessMsg);
				if ($scope.includedItems[itemIndex].attachments.length == 0)
					$scope.includedItems[itemIndex].attachment_submitted = false;
			}
			$scope.includedItems[itemIndex].attachment_action_in_progress = false;
			spUtil.get($scope,{action: "from_attachment"});
		};

		$scope.includedItems[itemIndex].confirmDeleteAttachment = function(attachment) {
			spModal.confirm($scope.data.msgs.delete_attachment).then(function() {
				$scope.includedItems[itemIndex].attachmentHandler.deleteAttachment(attachment);
				$scope.includedItems[itemIndex].attachment_action_in_progress = true;
				$scope.setFocusToAttachmentButton();
			});
		}
	}
	
	/********************************************************************************************/
	/********************************       Attachments  End      *******************************/
	/*****###############################################################################********/
	/********************************************************************************************/
	/********************************        UTIL Functions       *******************************/
	/*****###############################################################################********/

	function evalGuidePrice() {
		$scope.price = 0;
		var frequencyMap = {};
		for (var i = 0; i &lt; $scope.includedItems.length; i++) {
			if ($scope.includedItems[i].included &amp;&amp; $scope.includedItems[i].process_price) { 
				var qty = parseInt($scope.includedItems[i].quantity);
				var pricing = $scope.includedItems[i]._pricing;
				var effectivePrice = 0;
				var effectiveRecurringPrice = 0;
				if (typeof $scope.includedItems[i].price != "undefined") {
					effectivePrice = $scope.includedItems[i].price;
				}
				if (typeof $scope.includedItems[i].recurring_price != "undefined") {
					effectiveRecurringPrice = $scope.includedItems[i].recurring_price;
				}

				if (effectiveRecurringPrice &gt;= 0 &amp;&amp; pricing.rfd) {
					if(frequencyMap[pricing.rfd])
						frequencyMap[pricing.rfd] += effectiveRecurringPrice * qty;
					else
						frequencyMap[pricing.rfd] = effectiveRecurringPrice * qty;
				}
				if (effectivePrice &gt;= 0)
					$scope.price += effectivePrice * qty;
			}
		}
		frequencyMap.price = $scope.price;
		$scope.server.get({
			action: "format_prices",
			prices: frequencyMap
		}).then(function(response) {
			$scope.frequencySequence = response.data.frequencySequence;
			$scope.price_display = response.data.frequencyMap.price;
			$scope.frequencyMap = response.data.frequencyMap;
		});
	}
	
	function evalIncludes() {
		// don't allow submit while waiting on included items eval
		$scope.evaluatingIncludes = true;
		$scope.includedItems = [];
		var guideData = getFieldsData($scope.data.sc_cat_item);
		guideData.sysparm_id = $scope.data.sys_id;
		guideData.without_cart = true;
		guideData._fields = $scope.data.sc_cat_item._fields;
		guideData.cascade = $scope.data.sc_cat_item.cascade;
		if ($scope.data.workspaceParams) {
			guideData.sysparm_parent_sys_id = $scope.data.workspaceParams.sysparm_parent_sys_id;
			guideData.sysparm_parent_table = $scope.data.workspaceParams.sysparm_parent_table;
		}
		$scope.server.get({
			action: "init_guide",
			orderGuideData: guideData
		}).then(function(response) {
			if (response.data.error) {
				$scope.guide_step--;
				return;
			}
			$scope.includedItems = response.data.items;
			$scope.showIncludeToggle = response.data.showIncludeToggle;
			initAttachmentHandlers();
			$scope.includedItems.forEach(function(item) {
				item.description = $sce.trustAsHtml(item.description);
			});
			$scope.totalIncluded = $scope.includedItems.length;
			$scope.conflictingCartDomainMsg = response.data.conflictingCartDomainMsg;
			$scope.evaluatingIncludes = false;

			addCabrilloBottomButtons({
				title: [$scope.data.msgs.prevMsg, $scope.data.msgs.nextMsg],
				fn: [$scope.goPrev, $scope.goNext]
			});
		});
	}
	
	function getInvalidFields(gForm) {
		gForm._invalidFields = [];
		var fields = gForm.getFieldNames();
		for (var j = 0; j &lt; fields.length; j++) {
			var field = gForm.getField(fields[j]);
			if (field.isInvalid)
				gForm._invalidFields.push(field);
		}
	}	
	
	function getCurrentGForm() {
		if ($scope.guide_step == 0)
			return includedGformInstances[$scope.data.sc_cat_item.sys_id];
		else {
			var openItem = $scope.includedItems.find(function(item){
				return item.isOpen === true;
			});
			return includedGformInstances[openItem.sys_id];
		}
	}
	
	function openItemHelper(item, state, defer) {
		for (var i = 0; i &lt; $scope.includedItems.length; i++)
			if ($scope.includedItems[i].sys_id == item) {
				$scope.includedItems[i].included = state == 'true';
				$scope.includedItems[i].isOpen = true;
				$scope._atf.expose('g_form', spAtf.augmentForm(includedGformInstances[item]));
				defer.resolve();
			}
	}

	function getFieldsData(item) {
		var fieldData = {"variables":{}};
		for(var field in item._fields) {
			var fieldValue = "";
			if (item._fields[field].value != null &amp;&amp; typeof item._fields[field].value != "string")
				fieldValue = JSON.stringify(item._fields[field].value);
			else
				fieldValue = item._fields[field].value;
			fieldData.variables[item._fields[field].name] = fieldValue;

		}
		return fieldData;
	}

	function getGuideItems(cartname) {
		var items = [];
		var item;
		for(var i = 0; i &lt; $scope.includedItems.length; i++) {
			if($scope.includedItems[i].included) {
				item = getFieldsData($scope.includedItems[i]);
				item.sysparm_id = item.sysparm_active = $scope.includedItems[i].sys_id;
				item.sysparm_quantity = $scope.includedItems[i].quantity;
				item.sysparm_cart_name = cartname;
				item.sysparm_item_guid = $scope.includedItems[i].sysparm_item_guid;
				items.push(item);
			}
		}
		return items;
	}
	
	/*********************************************************************************************/
	/********************************          UTIL Functions End           **********************/
	/*****################################################################################********/
	/*********************************************************************************************/
	/********************************           Submit Handlers             **********************/
	/*****################################################################################********/
	
	$scope.triggerAddToCart = function() {
		var webAnalyticsMsgSuffix = $scope.data.isMEE ? " - NOW Mobile" : "";
		clearCabrilloBottomButtons();
		if($scope.conflictingCartDomainMsg) {
			spUtil.addErrorMessage($scope.conflictingCartDomainMsg);
			return;
		}
		if($scope.submitted)
			return;
		$scope.server.get({
			action: 'log_request',
			itemDetails: {sys_id: $scope.data.sc_cat_item.sys_id, 
										name: $scope.data.sc_cat_item.name,
										sys_class_name: $scope.data.sc_cat_item.sys_class_name}
		});
		$scope.submitted = true;
		$scope.server.get({
			action: "add_to_cart",
			items: getGuideItems(""),
			sys_id: $scope.data.sys_id
		}).then(function(response) {
			$rootScope.$broadcast("$sp.service_catalog.cart.add_item");
			$rootScope.$broadcast("$sp.service_catalog.cart.update");
			$scope.$emit("$sp.sc_order_guide.add_to_cart");
			window.GlideWebAnalytics.trackEvent('Service Catalog', 'Catalog Cart' + webAnalyticsMsgSuffix, 'Order Guide Added to Cart', 0, 0);
			if($scope.data.isMEE) {
				$scope.submitted = true;
				cabrillo.message.showMessage(cabrillo.message.SUCCESS_MESSAGE_STYLE, i18n.getMessage('Items have been added successfully to your cart'));
				$timeout(function () {
					cabrillo.flowControl.flowEnded();
					return;
				}, 200);
				return;
			}

			spModal.open({
				message: i18n.getMessage('Items have been added successfully'),
				size: 'sm',
				backdrop: 'static',
				keyboard: false,
				noDismiss: true,
				buttons: [
					{label: i18n.getMessage('Catalog Home'), cancel:true},
					{label: i18n.getMessage('View Cart'), primary:true}
				]
			}).then(function() {
				$location.search("id=sc_cart");
			}, function() {
				$location.search("id=sc_home");
			});
		});
	}
	
	// order / create request
	$scope.triggerSubmit = function() {
		clearCabrilloBottomButtons();
		if ($scope.submitted)
			return;

		$scope.server.get({
			action: 'log_request',
			itemDetails: {sys_id: $scope.data.sc_cat_item.sys_id, 
										name: $scope.data.sc_cat_item.name,
										sys_class_name: $scope.data.sc_cat_item.sys_class_name}
		});
		$scope.submitted = true;
		var hasItems = $scope.includedItems.filter(function(item) {
			return item.sys_class_name != 'sc_cat_item_producer';
		}).length &gt; 0;

		if ($scope.data.sys_properties.twostep &amp;&amp; $scope.data.sc_cat_item.request_method != "submit") {
			//Required to pass as payload for usage as embeddedWidget
			var embeddedWidgetOptions = {
				"auto_redirect" : "true",
				"requested_for_id" : "",
				"requested_for_display" : ""
			};
			var payload = {
				cart: '' + $scope.data.sys_id,
				itemDetails: {
					items: getGuideItems('' + $scope.data.sys_id),
					request_method: $scope.data.sc_cat_item.request_method
				},
				workspaceParams: $scope.data.workspaceParams,
				action: "order_guide"
			};
			for (var embeddedOption in embeddedWidgetOptions) {
				payload[embeddedOption] = c.options[embeddedOption] || embeddedWidgetOptions[embeddedOption];
			}
			$scope.server.get(payload).then(function(response) {
				var orderGuideModalCtrl;
				var unregister = $scope.$on('$sp.service_catalog.cart.cancel_order', function(){
					orderGuideModalCtrl.close();
					$scope.submitted = false;
					$timeout(function () {
						addCabrilloBottomButtons({
							title: [i18n.getMessage('Add to Cart'), $scope.submitButtonMsg],
							fn: [$scope.triggerAddToCart, $scope.triggerSubmit]
						});
					});
				});
				var closeModalOnSubmit = $scope.$on("$sp.service_catalog.cart.submitted", function () {
					orderGuideModalCtrl.close();
					$scope.submitted = true;
				});
				var orderGuideModal = angular.copy(response.data.orderGuideModal);
				orderGuideModal.options.afterOpen = function(ctrl){
					orderGuideModalCtrl = ctrl;
				};
				orderGuideModal.options.afterClose = function() {
					unregister();
					closeModalOnSubmit();
					$scope.orderGuideModal = null;
					orderGuideModalCtrl = null;
				};
				$scope.orderGuideModal = orderGuideModal;
			});
			return $scope.submitted;
		} else {
			$scope.data.action = 'checkout_guide';
			$scope.data.guideItems = getGuideItems('' + $scope.data.sys_id);
			$scope.server.update().then(function(response) {
				$scope.data.action = undefined;
				$scope.data.guideItems = undefined;
				$scope.$emit("$sp.sc_order_guide.submitted", $scope.data.result);
				window.GlideWebAnalytics.trackEvent('Service Catalog' + webAnalyticsMsgSuffix, 'Order Guide Request', 'Catalog Request Submitted', $scope.includedItemsCounter, 0);
				$scope.submitted = true;
				if ($scope.options.auto_redirect == 'false') {
					spUtil.addInfoMessage($scope.m.requestSubmitted);
					return;
				}
				else {
					if ($scope.data.result.request_id) 
						$location.search('id=sc_request&amp;is_new_order=true&amp;table=sc_request&amp;sys_id=' + $scope.data.result.request_id);
					else 
						$location.search('id=requests');

				}
			});
			return $scope.submitted;
		}
	}
	
	/*********************************************************************************************/
	/********************************        Submit Handlers End           ***********************/
	/*****################################################################################********/
	
	var catalogUtil = {
		updateGform: function() {
			var g_form = getCurrentGForm();
			if (g_form)
				$scope._atf.expose('g_form', spAtf.augmentForm(g_form));
		},

		addRow: function(fieldId, timeoutInMS) {
			var deferred = $q.defer();
			var g_form = getCurrentGForm();
			if (g_form) {
				if (timeoutInMS &lt;= 0)
					timeoutInMS = 1000;
				$scope.$broadcast("$sp.sc_multi_row.create_row", fieldId, g_form.getSysId());
				$scope.$on('spModel.gForm.initialized', function(e, gFormInstance) {
					if (gFormInstance.getSysId() == fieldId)
						deferred.resolve();
				});
				$timeout(function() {
					deferred.reject();
				}, timeoutInMS);
			}
			else
				deferred.reject();
			return deferred.promise;
		},

		navigateToStep: function(num, timeout) {
			var defer = $q.defer();
			var step = parseInt(num) - 1;
			if (Math.abs(step - $scope.guide_step) != 1) {
				defer.reject("Can't navigate to next step");
				return defer.promise;
			}
			if (step &gt; $scope.guide_step)
				$scope.goNext(timeout);
			else {
				$scope.goPrev();
				defer.resolve();
			}
			var cleanup = $scope.$on('$sp.service_catalog.form_submit_failed', function() {
				cleanup();
				defer.reject("Can't navigate to next step");
			});
			var cleanup1 = $scope.$on('$sp.service_catalog.form_submitted', function() {
				cleanup1();
				defer.resolve("Can navigate to next step");
			});
			return defer.promise;
		},

		validateIncludedList: function(list, stage) {
			var items = list.split(',').reduce(function(obj, item) {
				obj[item] = false;
				return obj;
			}, {});
			var included = stage == 1 ? $scope.includedItems : $scope.includedItems.filter(function(item) {
				return item.included == true;
			});
			if (Object.keys(items).length != included.length)
				return false;
			for (var i = 0; i &lt; included.length; i++)
				if (!items.hasOwnProperty(included[i].sys_id))
					return false;
			return true;
		},

		openItem: function(item, state, timeoutInMS) {
			if (timeoutInMS &lt;= 0)
				timeoutInMS = 10000;
			var defer = $q.defer();
			if (includedGformInstances[item]) {
				openItemHelper(item, state, defer);
			}
			$scope.$on('spModel.gForm.initialized', function(e, gFormInstance) {
				if (gFormInstance.getSysId() == item) {
					openItemHelper(item, state, defer);
				}
			});
			$timeout(function() {
				defer.reject();
			}, timeoutInMS);
			return defer.promise;
		},

		getPrice: function() {
			var res = {};
			var item = $scope.includedItems.find(function(itemData) {
				return itemData.isOpen == true;
			});
			if (item) {
				res.price = item.price;
				res.recurring_price = item.recurring_price;
				res.recurring_frequency = item.recurring_frequency;
			}
			return res;
		},

		getGuidePrice: function() {
			return $scope.price_display;
		},

		addToCart: function() {
			var defer = $q.defer();
			$scope.triggerAddToCart();
			if (!$scope.submitted)
				defer.reject("Can't submit form.");
			else
				defer.resolve();
			return defer.promise;
		},

		submitOrderGuide: function() {
			var defer = $q.defer();
			if ($scope.triggerSubmit()) {
				if ($scope.data.sys_properties.twostep &amp;&amp; $scope.data.sc_cat_item.request_method != "submit") {
					defer.resolve();
				}
				else{
					var cleanUp = $scope.$on('$sp.sc_order_guide.submitted', function(o, result) {
						$timeout(function() {
							cleanUp();
							result.single_step = true;
							defer.resolve(result);
						}, 10);
					});
				}
			}
			else
				defer.reject();
			return defer.promise;
		}
	};
	
	/********************************************************************************************/
	/********************************                ATF End            *************************/
	/*****###############################################################################********/
	/********************************************************************************************/
	/********************************            Cabrillo Start         *************************/
	/*****###############################################################################********/
	
	function clearCabrilloBottomButtons() {
		if ($scope.data.isMEE) {
			cabrillo.viewLayout.setBottomButtons();
		}
	}

	function showCabrilloBottomButtons() {
		if (!$scope.data.isMEE) return;

		if ($scope.guide_step === 0) {
			addCabrilloBottomButtons({
				title: [$scope.data.msgs.nextMsg],
				fn: [$scope.goNext]
			});
		}

		if ($scope.guide_step === 1) {
			var itemOpened = $scope.includedItems.find(function (item) {
				return item.isOpen;
			});

			if (itemOpened) {
				$scope.showCancel(itemOpened.sys_id);
			}
		}
	}
	
	function addCabrilloBottomButtons(buttonDetails) {
		if ($scope.data.isMEE) {
			var buttons = [];
			clearCabrilloBottomButtons();
			switch($scope.guide_step) {
				case 0:
					buttons = [
						{
							title: buttonDetails.title[0],
							enabled: true,
							backgroundColor: $scope.data.sys_properties.mobileNativeColor,
							textColor: '#FFFFFF'
						}];

					cabrillo.viewLayout.setBottomButtons(buttons, function(buttonIndex) {
						buttonDetails.fn[buttonIndex]();
					});
					cabrillo.viewLayout.showBackButton();
					break;

				case 1:
					buttons = [
						{
							title: buttonDetails.title[0],
							enabled: true,
							backgroundColor: '#f7f7f7',
							textColor: '#000000'
						},
						{
							title: buttonDetails.title[1],
							enabled: true,
							backgroundColor: $scope.data.sys_properties.mobileNativeColor,
							textColor: '#FFFFFF'
						}];
					cabrillo.viewLayout.setBottomButtons(buttons, function(buttonIndex) {
						//Disable next button in choose option if all the items are marked as not included.
						// however the previous button should still work
						if (!($scope.submitted || $scope.totalIncluded &lt;= 0) || buttonIndex === 0) {
							buttonDetails.fn[buttonIndex]();
						}
					});
					cabrillo.viewLayout.hideBackButton();
					break;

				case 2:
					if ($scope.data.sys_properties.cartEnabled &amp;&amp; $scope.showAddToCart) {
						buttons = [
							{
								title: buttonDetails.title[0],
								enabled: true,
								backgroundColor: '#f7f7f7',
								textColor: '#000000'
							},
							{
								title: buttonDetails.title[1],
								enabled: true,
								backgroundColor: $scope.data.sys_properties.mobileNativeColor,
								textColor: '#FFFFFF'
							}];
						cabrillo.viewLayout.setBottomButtons(buttons, function(buttonIndex) {
							buttonDetails.fn[buttonIndex]();
						});
					} else {
						buttons = [
							{
								title: buttonDetails.title[1],
								enabled: true,
								backgroundColor: $scope.data.sys_properties.mobileNativeColor,
								textColor: '#FFFFFF'
							}];
						cabrillo.viewLayout.setBottomButtons(buttons, function(buttonIndex) {
							buttonDetails.fn[1]();
						});
					}
					cabrillo.viewLayout.hideBackButton();
					break;
			}
		}
	}
	
	var mespOpenPopupUnregister = $rootScope.$on("mesp.popup.open", function() {
		// Timeout is to give a better user experience otherwise when this popup opens,
		// the cabrillo buttons will be displayed immediately giving a bad user experience.
		$timeout(function(){
			clearCabrilloBottomButtons();
		});
	});

	var mespClosePopupUnregister = $rootScope.$on("mesp.popup.close", function() {
		// Timeout is to give a better user experience otherwise when this popup opens,
		// the cabrillo buttons will be displayed immediately giving a bad user experience.
		$timeout(function(){
			showCabrilloBottomButtons();
		});
	});
	
	/**********************************************************************************************/
	/********************************            Cabrillo End           ****************************/
	/*****##################################################################################********/
}]]&gt;&lt;/client_script&gt;&lt;controller_as&gt;c&lt;/controller_as&gt;&lt;css&gt;.order-guide-mobile {
  border: 0;
  box-shadow: none;
  
  .mobile-attachment-label {
    float: none;
    display: flex;
    justify-content: center;
    margin-top: 10px;
    button, .add-attachment-content {
      color: $link-color;
    }
  }
  
  .mobile-summary{
  	display: flex;
    align-items: center;
    justify-content: space-between;
  }
  
  .iconlink {
  	padding: 0 !important;
    width: 100%;
    span.step-text {
      font-weight: bold;
      font-size: 20px;
      margin: 0 !important;
      top: 0;
      padding-left: 5px;
    }
  }
  
  .less-text .read-more,
  .more-text .read-less {
    display: block;
    text-align: center;
    margin: 10px auto;
  }
  
  .list-group-mobile {
		.accordion-header {
      &amp;amp;.disable-row .accordion-toggle {
        pointer-events: none;
        color: $gull-grey;
      }

      .accordion-toggle {
        &amp;amp;:focus {
        	border: 0;
          box-shadow: none;
        }
        
        .row {
          padding: 20px 0;
          margin: 0 !important;
          &amp;amp;&amp;gt;div {
          	padding: 0;
          }
        }
        
        .og-check-bucket {
          display: block;
          padding-left: 10px;
          height: 20px;
          width: 60px;

          input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
          }

          .og-check {
            position: absolute;
            pointer-events: auto;
            top: -3px;
            height: 30px;
            width: 30px;
            background-color: #fff;
            border: 1px solid $mesp-input-border;
            border-radius: 50%;

            &amp;amp;:after {
              content: "";
              position: absolute;
              display: none;
              left: 12px;
              top: 8px;
              width: 5px;
              height: 10px;
              border: solid #fff;
              border-width: 0 2px 2px 0;
              -webkit-transform: rotate(45deg);
              -ms-transform: rotate(45deg);
              transform: rotate(45deg);
            }
          }

          input:checked ~ .og-check {
            background-color: $mesp-input-radio;
            &amp;amp;:after {
              display: block;
            }
          }
        }

        .og-mobile-item {
          display: grid;
          grid-template-columns: auto 100px;
					
          .item-name {
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
            
            &amp;amp; ~ label {
            	justify-self: end;
            }
          }
          
          .options {
          	color: $gull-grey;
          }
          
          .accordion-icon {
            margin-left: 12px;
            padding-right: 3px;

            &amp;amp;:before {
              content: "\f105";
              font-family: FontAwesome;
              font-size: 20px;
            }
          }
        }
      }

      .collapsing {
        transition: none;
      }

	    .panel-heading, .panel-heading:hover {
        background-color: transparent;
      }
    }
   
    .guide-item-details-wrapper-mobile {      
      position: fixed !important;
      background-color: #FFF !important;
      z-index: 1 !important;
      height: 100% !important;
      width: 100% !important;
      top: 0 !important;
      left: 0 !important;
      overflow: scroll;
      
      .title-mobile {
        font-size: 22px;
        font-weight: 600;
      }
      
      .og-item-price {
        padding: 23px 0px 23px 14px;
        margin: 18px -8px 0px -8px;
        border-top: 1px solid $mesp-input-border;
        strong {
          font-size: 18px;
        }
        span {
          font-size: 14px;
        }
        label {
          display: block;
          color: $gull-grey;
        }
      }
    }
    
    .summary {
      section {
	      display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 5px 5px 5px 0;
      }
      
      .guide-item {
      	display: flex;
        align-items: center;
      }
      
      .guide-item-quantity {
        padding: 5px 10px;
        margin: 0 10px 0 0;
        background-color: #F0F0F0;
        border-radius: 5px;
      }
      
      .guide-item-name {
      	display: flex;
        flex-direction: column;
        align-items: flex-start;
      }
    }
  }
}

.guide-item-details-wrapper {
	position: relative;
  background-color: #F8F9F9;
}

.empty-state-content {
  margin-top: 30px;

  h3 {
    margin-bottom: 5px;
    text-align: center;
  }
}

.attachment-label {
  float: right;
  font-weight: normal;
  cursor: pointer;
}

.guide-image {
  max-height: 240px;
  padding: 5px;
  display: inline;
}

.panel-button {
  float: none;
}

.file-list-wrap {
	margin-bottom: 10px;
}

.guide-item-image {
  max-height: 150px;
  padding: 10px;
  display: inline-block !important;
}

.item-icon {
  max-width:100%;
  height:auto;
}

.disabled-mask {
  background-color: #F8F9F9;
  position: absolute;
  z-index: 8;
  opacity: 0.6;
  height: 100%;
  width: 100%;
  top: 0;
  left: 0;
  border-radius: 5px;
  cursor: not-allowed;
}

.guide-description, .guide-nav, .tab-item, .og-timeline {
  overflow: auto;
}


.guide-nav {
  padding: 0px 40px 20px 40px;
}

.guide-nav-setp1 {
  padding-right: 27px;
}

.iconlink {
  margin: 5px 0px 5px 0px;
}

.circle_icon {
    border: 3px solid;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    padding: 20px;
    display: inline-block;
    .step-icon {
      font-size: 20px;
    	position: relative;
    	top: -9px;
    	left: -10px;
    }
}

.step-text {
  	position: relative;
    top: -10px;
}

.step_active {
  color: $primary;
}

.step_inactive {
  color: $text-muted;
  opacity: 0.5;
}

.accordion-header {
  .panel-heading {
    padding: 0;
    .row {
      padding: 15px;
      margin: 0;
    }
    .align-text {
      top: 3px;
    }
    &amp;amp;:hover {
    	background-color: lighten($primary, 45%);
  	}
    label {
      font-size: inherit;
    }
  }
  &amp;amp;.panel-open {
    .panel-heading {
      border-bottom: 1px solid #dee5e7;
      &amp;amp;:hover {
    		background-color: transparent;
  		}
    }
  }
  .panel-title {
    	font-size: inherit;
  }
}

.list-group {
	padding-left: 28px;
  padding-right: 28px;
  padding-top: 10px;
  padding-bottom: 0px;
}

.accordion-icon {
  margin-left: 30px;
}


.mandatory-header {
  border-left: 3px #d9534f solid !important;
}

.mandatory-icon {
  color: #d9534f;
  margin-left: -9px
}

.timeline-container {
  position: sticky;
  position: -webkit-sticky;
  position: -ms-sticky;
  height:auto;
  top: -($font-size-h2 + $font-size-base + 48px);
  z-index: 10;
  background-color: inherit;
  border-radius: 4px 4px 0 0;
}

.og-timeline .iconlink label {
  font-weight: 600;
  font-size: 0.8em;
  line-height: 1.8em;
}

.include-loader {
  text-align: center;
  
}

.og-switch {
  .input-switch {
    font-size: inherit;
    label.switch {
      border-radius: 20px;
      &amp;amp;::before {
        border-radius: 20px;
      }
    }
    input[type=checkbox]:checked ~ .switch {
    	background-color: $primary;
		}
  }
}

.summary {
  tr {
    height: 69px;
  }
  margin-bottom: 0;
  .summary-excluded {
    color: #ccc;
  }
  .not-included-pill {
    color: #FFF;
    background-color: #f0ad4e;
    border-radius: 20px;
    font-size: 11px;
    font-weight: bolder;
    white-space: nowrap;
  }
}

.m-r-6 {
  margin-right: 6px !important;
}

.wrap-word {
  word-break: break-word;
  hyphens: auto;
}

//animation

.fa-pulse {
  -webkit-animation: fa-spin 1s infinite steps(8);
  animation: fa-spin 1s infinite steps(8);
}

.options {
  color: $primary;
}

@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
/* IE10+ CSS styles go here */
   .timeline-container {
   position: static;
   top: 0px;
   }
}
@media only screen and (max-width:992px) {
  .pull-left-xs {
    float: left !important;
  }
  
  .left-align-xs {
    text-align: left !important;
  }
  
  .padding-left-xs {
    padding-left:15px !important;
  }
  
  .iconlink {
    padding: 0 15px;
  }
  
  .wrapper-cart-xs {
    padding: 10px !important;
  }
  
  .not-included {
    padding: 3px !important;
  }
  
  .pull-right-xs {
    float: right !important;
  }
  
  .remove-margin-bottom-xs {
    margin-bottom: 0px !important;
  }
  
  .add-margin-bottom-xs {
    margin-bottom: 15px !important;
  }
  
  .list-group {
    padding-left: 13px !important;
    padding-right: 13px !important;
  }

  .border-top-xs {
    border-top: none;
  }
  
  .border-bottom-xs {
    border-bottom: none;
  }
  
  .button-image-xs {
    padding-left: 7%;
    line-height: 160%;
  }
  
  .guide-image {
    display: block;
    margin: auto;
    max-height: 220px
  }
  
  .og-switch {
    padding-top:10px;
    .input-switch {
      margin-left: 5px !important;
    }
    .input-switch input[type=checkbox]  ~ .switch {
       height: 20px;
       width: 35px
    }
    .input-switch input[type=checkbox]:checked  ~ .switch:before {
      left: 15.5px;
    }
   }
  .summary {
     tr {
         height: 33px;
      }
    .summary-excluded {
    	color: inherit;
  	}
  }
  .timeline-container {
    top: -($font-size-h2 + $font-size-base + 28px);
  }
  .guide-nav-setp1 {
    padding: 0 13px 20px 13px;
  }
	.timeline-container {
     position: inherit;
  }
  .included-xs {
    font-size:13px; 
    vertical-align:3px;
  }
  .panel-body {
    padding: 0;
  }
  .guide-item-image-xs {
    max-height: 120px;
  	padding: 10px;
    float: left;
  }
  .guide-description {
    display: inline;
  }
  .read-more, .read-less {
    font-size: 15px;
    cursor: pointer;
  }
  .more-text {
    display: none;
  }
}&lt;/css&gt;&lt;data_table&gt;sp_instance&lt;/data_table&gt;&lt;demo_data/&gt;&lt;description/&gt;&lt;docs/&gt;&lt;field_list&gt;color,title&lt;/field_list&gt;&lt;has_preview&gt;false&lt;/has_preview&gt;&lt;id&gt;gservice_sc_order_guide&lt;/id&gt;&lt;internal&gt;false&lt;/internal&gt;&lt;link&gt;&lt;![CDATA[function(scope, elem) {
		scope.setFocusToAttachmentButton = function () {
			elem.find('.sp-attachment-add')[0].focus();
		}
	}
	]]&gt;&lt;/link&gt;&lt;name&gt;GService SC Order Guide&lt;/name&gt;&lt;option_schema&gt;[{"hint":"This property will 'show less' description of order guide with an option of 'read more' to read full description.","name":"show_less_orderguide","default_value":"true","section":"Presentation","label":"Enable Show More/Less for Order Guide description on Mobile","type":"boolean"},{"hint":"Show the widget in compact mode","name":"compact_mode","section":"Presentation","default_value":"false","label":"Compact Mode","type":"boolean"},{"hint":"Hide Delivery Time in each Item","name":"hide_delivery_time","section":"Presentation","default_value":"false","label":"Hide Delivery Time","type":"boolean"},{"hint":"Show the add to cart button","name":"show_add_cart_button","section":"Behavior","default_value":"true","label":"Show Add to Cart","type":"boolean"}]&lt;/option_schema&gt;&lt;public&gt;false&lt;/public&gt;&lt;roles/&gt;&lt;script&gt;&lt;![CDATA[(function () {
	var guideJS;
	data.isTwoStepEnabled = gs.getProperty('glide.sc.sp.twostep');
	var localInput = input; //to safeguard pullution of "input" via BR or other scripts
	
	if (localInput &amp;&amp; localInput.action == "from_attachment")
		return;

	data.sys_id = $sp.getParameter("sys_id");	
	['auto_redirect', 'requested_for_id', 'requested_for_display'].forEach(function (embeddedWidgetOption) {
		if (localInput &amp;&amp; typeof localInput[embeddedWidgetOption] != 'undefined')
			options[embeddedWidgetOption] = localInput[embeddedWidgetOption];
	});
	
	if(localInput &amp;&amp; localInput.action == 'order_guide') {
		data.orderGuideModal = $sp.getWidget('widget-modal', {
																											embeddedWidgetId: 'sc-checkout', 
																											embeddedWidgetOptions: {
																																	cart: {name: localInput.cart}, 
																																	action: localInput.action, 
																																	item: localInput.itemDetails, 
																																	requested_for: {id:options.requested_for_id, displayValue:options.requested_for_display}, 
																																	auto_redirect: options.auto_redirect,
																																	parentParams: localInput.workspaceParams,
																																	native_mobile: options.native_mobile
																																}, 
																											backdrop: 'static', 
																											keyboard: false, 
																											size: 'md'
																								});
		return;
	}
	else if (localInput &amp;&amp; localInput.action === 'log_request') {
		 $sp.logStat('Cat Item Request', localInput.itemDetails.sys_class_name, localInput.itemDetails.sys_id, localInput.itemDetails.name, $sp.getPortalRecord().getUniqueValue());
		 return;
	}
	else if(localInput &amp;&amp; localInput.action == "init_guide") {
		guideJS = new sn_sc.OrderGuide('' + localInput.orderGuideData.sysparm_id);
		var temp = guideJS.init(localInput.orderGuideData);
		if (JSUtil.notNil(temp.errMsg)) {
			gs.addErrorMessage(temp.errMsg);
			data.error = true;
			return;
		}
		data.showIncludeToggle = guideJS.isIncludeItems();
		data.items = [];
		var item;
		for(var i = 0; i &lt; temp.items.length; i++) {
			var catItem = new sn_sc.CatItem('' + temp.items[i].sys_id);
			if(!catItem.canView() || !catItem.isVisibleServicePortal())
				continue;
			var itemData = {
				'sys_id': temp.items[i].sys_id, 
				'table': 'sc_cat_item', 
				'quantity': temp.items[i].quantity, 
				'is_guide': true, 
				'is_ordering': true,
				'variables' : {}
			};
			if (localInput.orderGuideData.cascade) {
				for (var gf in localInput.orderGuideData._fields) {
					var field = localInput.orderGuideData._fields[gf];
					itemData.variables[field.name] = field.value;	
				}
			}
			item = $sp.getCatalogItem(itemData);
			item.quantity = temp.items[i].quantity;
			item.show_quantity = temp.items[i].show_quantity;
			item.isOrderGuideItem = true;
			item.included = true;
			item.sysparm_item_guid = gs.generateGUID();
			item._attachmentGUID = item.sysparm_item_guid;
			item.order = parseInt(temp.items[i].order);
			item.native_mobile = options.native_mobile == 'true';
			
			var table_name = 'sc_cart_item';
			var className = item.sys_class_name;
			if (!new global.CatalogItemTypeProcessor().canCreateNormalCartItem(className)) {
				if (className == 'sc_cat_item_producer') {
					var gr = new GlideRecord('sc_cat_item_producer');
					if (gr.get(item.sys_id))
						table_name = gr.getValue('table_name');
				}
			}
			item.targetTable = table_name;
			if (localInput.orderGuideData.cascade) {
				for (var field in item._fields) {
					var f = item._fields[field];
					for (var gf in localInput.orderGuideData._fields) {
						if (localInput.orderGuideData._fields[gf].name === f.name) {
							f.value = localInput.orderGuideData._fields[gf].value;
							f.displayValue = localInput.orderGuideData._fields[gf].displayValue;
							f.display_value_list = localInput.orderGuideData._fields[gf].display_value_list;
							break;
						}
					}
				}
			}
			if (temp.variable_assignments[item.sys_id]) {
				var cur = temp.variable_assignments[item.sys_id];
				for (var fieldId in cur) {
					var q = GlideappQuestion.getQuestion(fieldId);
					item._fields[q.getName()].value = cur[fieldId];
					
					if (q.getType() == 21 || q.getType() == 8) {
						q.setValue(cur[fieldId]);
						if (q.getType() == 21) {
							var vals = '' + q.getDisplayValues();
							vals = vals.slice(1, -1);
							item._fields[q.getName()].display_value_list = vals.split(', ');
						}
					}
					item._fields[q.getName()].displayValue = q.getDisplayValue();
				}
			}
			data.items.push(item);
		}
		if(temp.conflicting_cart_domain)
			data.conflictingCartDomainMsg = gs.getMessage("Your cart has item(s) belonging to '{0}' domain. To continue to add this item, clear the cart or check out the existing item(s).", temp.conflicting_cart_domain);
		return;
	}
	else if(localInput &amp;&amp; localInput.action == "checkout_guide") {
		guideJS = new sn_sc.OrderGuide('' + data.sys_id);
		var cartJS = new sn_sc.CartJS('' + data.sys_id);
		for(var i = 0; i &lt; localInput.guideItems.length; i++)
			guideJS.navigateFromMap(localInput.guideItems[i]);
		cartJS.activateGuide();
		cartJS.setParentParams(localInput.workspaceParams);
		data.result = cartJS.checkoutGuide();
		return;
	}
	else if(localInput &amp;&amp; localInput.action == "add_to_cart") {
		var cart = new sn_sc.CartJS();
		guideJS = new sn_sc.OrderGuide('' + localInput.sys_id);
		for(var i = 0; i &lt; localInput.items.length; i++) {
			localInput.items[i].sysparm_cart_name = "";
			guideJS.navigateFromMap(localInput.items[i]);
		}
		if (guideJS.isUseCustomCart())
			new sn_sc.CartJS(localInput.sys_id).empty("");
		cart.activateGuide();
		return;
	}
	else if(localInput &amp;&amp; localInput.action == "format_prices") {
		data.frequencySequence = [];
		var gr = new GlideRecord('sys_choice');
		gr.addQuery('name', 'sys_frequency');
		gr.orderBy('sequence');
		gr.query();
		while(gr.next())
			data.frequencySequence.push(gr.label.getDisplayValue());
		var spCurrencyFormatter = new SPCurrencyFormatter();
		data.frequencyMap = {};
		for(var key in localInput.prices)
			data.frequencyMap[key] = spCurrencyFormatter.format(localInput.prices[key]);
		return;
	}
	
	// portal can specify a catalog and category home page
	data.sc_catalog_page = $sp.getDisplayValue("sc_catalog_page") || "sc_home";
	data.sc_category_page = $sp.getDisplayValue("sc_category_page") || "sc_category";
	var catalogID = $sp.getParameter("catalog_id") ? $sp.getParameter("catalog_id") + "" : "-1";
	var m = data.msgs = {};
	m.scHomeMsg = gs.getMessage("Service Catalog");
	m.step1 = gs.getMessage("Describe Needs");
	m.step2 = gs.getMessage("Choose Options");
	m.step3 = gs.getMessage("Summary");
	m.prevMsg = gs.getMessage("Previous");
	m.nextMsg = gs.getMessage("Next");
	m.submitMsg = gs.getMessage("Submit");
	m.orderNowMsg = gs.getMessage("Order Now");
	m.requestMsg = gs.getMessage("Request");
	m.submittedMsg = gs.getMessage("Submitted");
	m.createdMsg = gs.getMessage("Created");
	m.clickMsg = gs.getMessage("click here to view");
	m.dialogTitle = gs.getMessage("Delete Attachment");
	m.dialogMessage = gs.getMessage("Are you sure?");
	m.dialogOK = gs.getMessage("OK");
	m.dialogCancel = gs.getMessage("Cancel");
	m.viewAttachedImage = gs.getMessage("View attached image");
	m.downloadAttachment = gs.getMessage("Download attachment");
	data.maxAttachmentSize = parseInt(gs.getProperty("com.glide.attachment.max_size", 1024));
	if (isNaN(data.maxAttachmentSize))
		data.maxAttachmentSize = 24;
	m.largeAttachmentMsg = gs.getMessage("Attached files must be smaller than {0} - please try again", "" + data.maxAttachmentSize + "MB");
	m.renameSuccessMsg = gs.getMessage("Attachment renamed successfully");
	m.deleteSuccessMsg = gs.getMessage("Attachment deleted successfully");
	m.invalidRecordMsg = gs.getMessage('You are either not authorized or record is not valid.');
	m.delete_attachment = gs.getMessage("Delete Attachment?");
	data.hideDeliveryTime = (options.hide_delivery_time == 'true');
	if (options.sys_id)
		data.sys_id = options.sys_id;
	if (!data.sys_id)
		return;
	var validatedItem = new sn_sc.CatItem('' + data.sys_id);
  if (!validatedItem.canView())
    return;

	data.sys_properties = {
		twostep: gs.getProperty("glide.sc.sp.twostep", "true") == 'true',
		mobileNativeColor: gs.getProperty("glide.sc.mobile.primary_color", "#1f8476"),
		cartEnabled: gs.getProperty("glide.sc.cart.enabled", "false") == "true"
	};
	data.showPrices = $sp.showCatalogPrices();
  data.sc_cat_item = $sp.getGuide(data.sys_id, true, false);
	data.recordFound = true;
	data.readonly_user = gs.hasRole('snc_read_only');
	data.sc_cat_item.native_mobile = options.native_mobile == 'true';

	if (data.sc_cat_item.category) {
		var categoryJS;
		var categoryID = validatedItem.getFirstAccessibleCategoryForSearch((catalogID &amp;&amp; catalogID != "-1" ? catalogID : $sp.getCatalogs().value + ""));
		if (GlideStringUtil.isEligibleSysID($sp.getParameter("sysparm_category"))) {
			categoryJS = new sn_sc.CatCategory($sp.getParameter("sysparm_category") + "");
			categoryID = $sp.getParameter("sysparm_category") + "";
		}
		else if (categoryID)
			categoryJS = new sn_sc.CatCategory(categoryID);
		
		if (categoryJS &amp;&amp; GlideStringUtil.isEligibleSysID(categoryJS.getID())) {
			data.category = {
				name: categoryJS.getTitle(),
				url: '?id=' + data.sc_category_page + '&amp;sys_id=' + categoryID
			}
			if (categoryJS.getCatalog()) {
				catalogID = categoryJS.getCatalog();
				data.catalog_id = catalogID;
				var catalogObj = new sn_sc.Catalog(catalogID);
				data.sc_catalog = catalogObj.getTitle();
			}
			
			data.categories = [];
			data.categories.push({
				label: categoryJS.getTitle(),
				url: '?id=' + data.sc_category_page + '&amp;sys_id=' + categoryID
			});
			while(categoryJS &amp;&amp; categoryJS.getParent()) {
				var parentId =  categoryJS.getParent();
				categoryJS = new sn_sc.CatCategory(parentId);
				var category = {
					label: categoryJS.getTitle(),
					url: '?id=' + data.sc_category_page + '&amp;sys_id=' + parentId
				};
				data.categories.unshift(category);
			}
			if ((($sp.getCatalogs().value + "").split(",")).length &gt; 1) {
				data.all_catalog_msg = gs.getMessage("All Catalogs");
			}
		}
	}
	$sp.logStat('Cat Item View', data.sc_cat_item.sys_class_name, data.sc_cat_item.sys_id, data.sc_cat_item.name, $sp.getPortalRecord().getUniqueValue());
})()]]&gt;&lt;/script&gt;&lt;servicenow&gt;false&lt;/servicenow&gt;&lt;sys_class_name&gt;sp_widget&lt;/sys_class_name&gt;&lt;sys_created_by&gt;organize.fernando&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2020-06-04 18:15:06&lt;/sys_created_on&gt;&lt;sys_id&gt;bcea650cdb19d450fa11cf24149619c8&lt;/sys_id&gt;&lt;sys_mod_count&gt;2&lt;/sys_mod_count&gt;&lt;sys_name&gt;GService SC Order Guide&lt;/sys_name&gt;&lt;sys_package display_value="ITSM Service Portal" source="x_gmeps_itsm_servi"&gt;334ae627dbc85c105c1163901496192f&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="ITSM Service Portal"&gt;334ae627dbc85c105c1163901496192f&lt;/sys_scope&gt;&lt;sys_update_name&gt;sp_widget_bcea650cdb19d450fa11cf24149619c8&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;organize.fernando&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2020-06-04 18:17:40&lt;/sys_updated_on&gt;&lt;template&gt;&lt;![CDATA[&lt;div class="" sn-atf-blacklist="IS_SERVICE_CATALOG"&gt;
  &lt;sp-widget widget="orderGuideModal" ng-if="orderGuideModal"&gt;&lt;/sp-widget&gt;
	&lt;div ng-if="::data.sc_cat_item" class="row"&gt;
		&lt;div class="col-sm-12"&gt;
			&lt;div ng-class="['panel', 'panel-default', {'order-guide-mobile': {{::data.isMEE}}}]"&gt;
				&lt;div ng-class="['timeline-container', {'b-b': {{::!data.isMEE}}}]"&gt;
					&lt;div class="wrapper-md break-word" ng-if="::!data.isMEE"&gt;
						&lt;h2 class="h2 m-n font-thin" ng-if="::data.sc_cat_item.name"&gt;{{::data.sc_cat_item.name}}&lt;/h2&gt;
             &lt;div class="text-muted hidden-xs hidden-sm" ng-if="::data.sc_cat_item.short_description"&gt;{{::data.sc_cat_item.short_description}}&lt;/div&gt;
					&lt;/div&gt;
					&lt;div ng-class="['wrapper-xs og-timeline', {'b-t': {{::!data.isMEE}}}]"&gt;
						&lt;div class="iconlink col-sm-4 text-a-l pull-left-xs padding-left-xs" ng-class = "{'hidden-xs hidden-sm' : guide_step != 0, 'hidden-lg hidden-md' : (options.compact_mode == 'true' || data.isMEE) &amp;&amp; guide_step != 0, 'col-sm-6' : options.compact_mode == 'true' &amp;&amp; guide_step == 0}" style="padding-left:61px"&gt;
								&lt;div ng-if="::!data.isMEE" class="circle_icon" ng-class="guide_step == 0 ? 'step_active' : 'step_inactive'"&gt;
                &lt;i class="fa fa-edit step-icon" style="left: -8px;"/&gt;
              &lt;/div&gt;
							&lt;span class="text-muted m-l-sm step-text"&gt;{{m.step1}}&lt;/span&gt;	
						&lt;/div&gt;
						&lt;div class="iconlink col-sm-4 pull-left-xs left-align-xs" ng-class = "{'hidden-xs hidden-sm' : guide_step != 1 , 'hidden-lg hidden-md' : (options.compact_mode == 'true' || data.isMEE) &amp;&amp; (guide_step != 1 || isItemOpened), 'col-sm-6' : options.compact_mode == 'true' &amp;&amp; guide_step == 1, 'text-a-c': {{ ::!data.isMEE}} }"&gt;
              &lt;div ng-if="::!data.isMEE" class="circle_icon" ng-class="guide_step == 1 ? 'step_active' : 'step_inactive'"&gt;
                &lt;i class="fa fa-list step-icon"/&gt;
              &lt;/div&gt;
							&lt;span class="text-muted m-l-sm step-text"&gt;{{m.step2}}&lt;/span&gt;
						&lt;/div&gt;
						&lt;div class="iconlink col-sm-4 text-a-r left-align-xs" ng-class = "{'pull-left-xs': {{::!data.isMEE}}, 'hidden-xs hidden-sm' : guide_step != 2 , 'hidden-lg hidden-md' : (options.compact_mode == 'true' || data.isMEE) &amp;&amp; guide_step != 2, 'col-sm-6' : options.compact_mode == 'true' &amp;&amp; guide_step == 2}" style="padding-right:61px"&gt;
              &lt;div ng-if="::!data.isMEE" class="circle_icon" ng-class="guide_step == 2 ? 'step_active' : 'step_inactive'"&gt;
                &lt;i class="fa fa-check step-icon" style="top: -10px;left: -9px;"/&gt;
              &lt;/div&gt;
              &lt;span ng-if="::!data.isMEE" class="text-muted m-l-sm step-text"&gt;{{m.step3}}&lt;/span&gt;
              &lt;div ng-if="::data.isMEE" class="mobile-summary"&gt;
                &lt;span class="text-muted m-l-sm step-text"&gt;{{m.step3}}&lt;/span&gt;
                &lt;a ng-if="::data.isMEE" ng-disabled="submitted" name="prev" ng-click="goPrev()"&gt;${Edit Options}&lt;/a&gt;
              &lt;/div&gt;
						&lt;/div&gt;
					&lt;/div&gt;
				&lt;/div&gt;
				&lt;div ng-class="{'padder-md padder-t-md': {{::!data.isMEE}}}" ng-if="guide_step == 0"&gt;
          &lt;div class="row"&gt;
            &lt;div ng-if="::data.sc_cat_item.picture" class="col-xs-12 col-sm-12 col-md-3 col-lg-3"&gt;
              &lt;img class="img-responsive catalog-item-image guide-image" ng-src="{{::data.sc_cat_item.picture}}?t=medium" /&gt;
            &lt;/div&gt;
            &lt;div ng-if="data.sc_cat_item.description" class="col-xs-12 col-sm-12 col-md-9 col-lg-9 break-word"&gt;
              &lt;div class="col-md-9 col-lg-9 visible-md visible-lg" ng-class="{false : 'visible-xs visible-sm', true : 'hidden-xs hidden-sm'}[options.show_less_orderguide === 'true']"&gt;	
              	&lt;div class="m-t guide-description" ng-bind-html="::data.sc_cat_item.description"&gt;&lt;/div&gt;
              &lt;/div&gt;
              &lt;div class="visible-xs visible-sm col-xs-12 col-sm-12" ng-if="::(options.show_less_orderguide === 'true')"&gt;
            		&lt;sc-toggle-data sn-data="::data.sc_cat_item.description"&gt;&lt;/sc-toggle-data&gt;
            	&lt;/div&gt;
            &lt;/div&gt;
	        &lt;/div&gt;
					&lt;div class="wrapper-md" ng-class="data.sc_cat_item.picture || data.sc_cat_item.description ? 'b-t' : ''"&gt;
						&lt;sp-model form-model="data.sc_cat_item" mandatory="data.sc_cat_item._mandatory"&gt;&lt;/sp-model&gt;
					&lt;/div&gt;
				&lt;/div&gt;
				&lt;div ng-if="guide_step == 1"&gt;
          &lt;div ng-if="evaluatingIncludes" class="include-loader"&gt;
            &lt;i class="fa fa-spinner fa-pulse fa-3x fa-fw"&gt;&lt;/i&gt;
						&lt;span class="sr-only"&gt;${Loading...}&lt;/span&gt;
          &lt;/div&gt;
					&lt;div class="remove-margin-bottom-xs" ng-if="includedItems.length"&gt;
						&lt;div ng-class="::data.isMEE ? 'list-group-mobile' : 'list-group'"&gt;
            &lt;div ng-if="::!data.isMEE" class="pull-right text-xs"&gt;&lt;i class="fa fa-asterisk mandatory"&gt;&lt;/i&gt; &lt;span class="text-muted"&gt;${Mandatory Fields}&lt;/span&gt;&lt;/div&gt;
						&lt;div ng-class="['m-b-lg', '{{::!data.isMEE ? 'font-bold' : 'm-l-sm'}}']"&gt;${Included Items: }&lt;/div&gt;
             &lt;uib-accordion close-others="true"&gt;
							&lt;uib-accordion-group
                                   ng-class="['accordion-header', {'b': !data.isMEE , 'disable-row': !item.included }]"
                                   template-url="group-template.html"
                                   ng-init="initAttachmentCallbacks($index);"
                                   ng-repeat="item in includedItems track by item.sys_id | orderBy: 'order'"
                                   id="{{::item.sys_id}}"
                                   is-open="item.isOpen"&gt;
                &lt;uib-accordion-heading&gt;
                  &lt;div class="row" ng-class="{'b-b': {{ ::data.isMEE }} }" ng-click="showCancel(item.sys_id)"&gt; 
                    &lt;div class="col-sm-2 col-xs-2" ng-if="::data.isMEE &amp;&amp; showIncludeToggle"&gt;	
                      &lt;label class="og-check-bucket" ng-click="$event.stopPropagation()" &gt;
                        &lt;input type="checkbox"
                               ng-model="item.included"
                               tabindex="0"
                               aria-label="${Included}"
                               id="enable_switch_{{::item.sys_id}}"  /&gt;
                        &lt;span class="og-check" ng-click="toggleItemState(item)" for="enable_switch_{{::item.sys_id}}" /&gt;
                      &lt;/label&gt;
                    &lt;/div&gt;
                    &lt;div class="align-text" ng-class="::data.isMEE ? 'col-xs-10 col-sm-10 og-mobile-item' : 'col-md-3 col-lg-3 col-xs-12 col-sm-12 font-bold'" id="item_name_{{::item.sys_id}}"&gt;
                      &lt;img ng-if="::item.icon &amp;&amp; !data.isMEE" ng-src="{{::item.icon}}" class="item-icon pad-right hidden-xs hidden-sm"/&gt;
                      &lt;span aria-role="heading" aria-level="3" ng-class="::data.isMEE ? 'item-name' : 'break-word'"&gt;
                        &lt;i class="fa fa-asterisk mandatory" ng-if="data.isMEE &amp;&amp; (item._mandatory.length ||  (item.mandatory_attachment &amp;&amp; !item.attachment_submitted)) &amp;&amp; item.included"&gt;&lt;/i&gt;
                        {{::item.name}}
                      &lt;/span&gt;
                      &lt;label class="visible-sm-inline-block visible-xs-inline-block options m-l-xs pull-right-xs" ng-class="{'visible-md-inline-block visible-lg-inline-block': {{ ::data.isMEE }}}"&gt;
                        &lt;span ng-if="::data.isMEE &amp;&amp; (item._sections.length &gt; 0 || item.mandatory_attachment)"&gt;${Options}&lt;/span&gt;
                        &lt;span class="fa accordion-icon" ng-class="{'hidden-md hidden-lg': {{ ::!data.isMEE }} }" ng-if="item.included" title="{{item.isOpen ?'${Collapse}':'${Expand}'}}" aria-hidden="true"&gt;&lt;/span&gt;
                      &lt;/label&gt;
                    &lt;/div&gt;
                    &lt;div ng-if="::!data.isMEE" class="col-md-6 col-lg-6 hidden-xs hidden-sm align-text break-word" aria-hidden="true"&gt;
                      {{::item.short_description}}
                    &lt;/div&gt;
                    &lt;div ng-if="::!data.isMEE" class="col-md-3 col-lg-3 col-xs-12 col-sm-12 text-a-r pull-left-xs left-align-xs align-text" ng-class="{'og-switch': {{ ::!data.isMEE }} }"&gt; 
                      &lt;span class="hidden-sm hidden-xs pull-left options" ng-if="::item._sections.length &gt; 0 || item.mandatory_attachment"&gt; 
                        &lt;i class="fa fa-asterisk mandatory" ng-if="(item._mandatory.length ||  (item.mandatory_attachment &amp;&amp; !item.attachment_submitted)) &amp;&amp; item.included"&gt;&lt;/i&gt;
                        &lt;i class="m-l-sm" ng-if="!(item._mandatory.length ||  (item.mandatory_attachment &amp;&amp; !item.attachment_submitted)) || !item.included"&gt;&lt;/i&gt;
                        ${Options}
                      &lt;/span&gt;
                      &lt;div class="inline" ng-if="::!data.isMEE &amp;&amp; showIncludeToggle"&gt;	
                        &lt;div class="input-switch inline v-middle m-l" ng-click="$event.stopPropagation()" uib-tooltip="{{item.included ? '${Included}' : '${Not Included}'}}" tooltip-placement="top" tooltip-append-to-body="true" role="none"&gt;
                          &lt;input type="checkbox"
                                 ng-model="item.included"
                                 tabindex="0"
                                 aria-label="${Included}"
                                 id="enable_switch_{{::item.sys_id}}"  /&gt;
                          &lt;label class="switch" for="enable_switch_{{::item.sys_id}}" ng-click="toggleItemState(item)"&gt;&lt;/label&gt;
                        &lt;/div&gt;
                      &lt;/div&gt;
                      &lt;span class="visible-sm-inline-block visible-xs-inline-block options m-l-lg" ng-if="::!data.isMEE &amp;&amp; (item._sections.length &gt; 0 || item.mandatory_attachment)"&gt; 
                        &lt;i class="fa fa-asterisk mandatory" ng-if="(item._mandatory.length ||  (item.mandatory_attachment &amp;&amp; !item.attachment_submitted)) &amp;&amp; item.included"&gt;&lt;/i&gt;
                        &lt;i class="m-l-sm" ng-if="!(item._mandatory.length ||  (item.mandatory_attachment &amp;&amp; !item.attachment_submitted)) || !item.included"&gt;&lt;/i&gt;
                        ${Options}
                      &lt;/span&gt;
                      &lt;span class="fa accordion-icon hidden-xs hidden-sm" ng-class="item.isOpen ? 'fa-chevron-up' : 'fa-chevron-down'" title="{{item.isOpen ?'${Collapse}':'${Expand}'}}" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;/div&gt;
                  &lt;/div&gt;
                &lt;/uib-accordion-heading&gt;
								&lt;div id="item_details_{{::item.sys_id}}" role="region" aria-labelledby="{{::item.sys_id}}" sp-pause-child-watchers-if-hidden&gt;
                  &lt;div class="wrapper" ng-class="::data.isMEE ? 'guide-item-details-wrapper-mobile' : 'guide-item-details-wrapper'"&gt;
                    &lt;div class="panel-body"&gt;
                      &lt;div class="row m-b-lg"&gt;
                        &lt;div class="col-xs-12 col-sm-12 hidden-md hidden-lg padder-b break-word" ng-class="{'title-mobile' : {{ ::data.isMEE}} }" aria-hidden="true"&gt;
                      		{{::item.short_description}}
                          &lt;div ng-if="::!data.isMEE" class="font-normal pull-right m-r-sm hidden-md hidden-lg"&gt;
                            &lt;span class="" ng-if="data.showPrices &amp;&amp; item.price"&gt;{{item.price_display}} {{item.recurring_price ? '+' : ''}}&lt;/span&gt; &lt;span class="" ng-if="data.showPrices &amp;&amp; item.recurring_price"&gt; {{item.recurring_price_display}} {{item.recurring_price_frequency}}&lt;/span&gt;
                            &lt;div class="" ng-if="!data.hideDeliveryTime &amp;&amp; item.sys_class_name != 'sc_cat_item_producer' &amp;&amp; item.sys_class_name != 'sc_cat_item_guide' &amp;&amp; (!item.no_delivery_time &amp;&amp; item.estimated_delivery_time)"&gt;{{::item.estimated_delivery_time}} ${Delivery}&lt;/div&gt;                          
                          &lt;/div&gt;
                        &lt;/div&gt;
                        &lt;div class="col-lg-3 col-md-3 hidden-xs hidden-sm" ng-if="::item.picture"&gt;
                          &lt;img ng-if="::item.picture" class="img-responsive catalog-item-image guide-item-image" ng-src="{{::item.picture}}" /&gt;  
                        &lt;/div&gt;
                        &lt;div class="col-lg-9 col-md-9 col-xs-12 col-sm-12"&gt;
                          &lt;div ng-if="::!data.isMEE" class="font-normal pull-right m-r-sm hidden-xs hidden-sm"&gt;
                            &lt;span class="" ng-if="data.showPrices &amp;&amp; item.price"&gt;{{item.price_display}} {{item.recurring_price ? '+' : ''}}&lt;/span&gt; &lt;span class="" ng-if="data.showPrices &amp;&amp; item.recurring_price"&gt; {{item.recurring_price_display}} {{item.recurring_price_frequency}}&lt;/span&gt;
                            &lt;div class="" ng-if="!data.hideDeliveryTime &amp;&amp; item.sys_class_name != 'sc_cat_item_producer' &amp;&amp; item.sys_class_name != 'sc_cat_item_guide' &amp;&amp; (!item.no_delivery_time &amp;&amp; item.estimated_delivery_time)"&gt;{{::item.estimated_delivery_time}} ${Delivery}&lt;/div&gt;
                          &lt;/div&gt;
                          &lt;img ng-if="::item.picture" class="img-responsive catalog-item-image hidden-lg hidden-md" ng-class="{'guide-item-image-xs': {{::!data.isMEE }} }" ng-src="{{::item.picture}}" /&gt;  
                          &lt;div ng-if="::item.description" class="m-t guide-description clearfix visible-md visible-lg break-word" ng-bind-html="::item.description" ng-class="::{false : 'visible-xs visible-sm', true : 'hidden-xs hidden-sm'}[options.show_less_orderguide === 'true']"&gt;&lt;/div&gt;
                          &lt;div class="visible-xs visible-sm break-word" ng-if="::(options.show_less_orderguide === 'true')"&gt;
                            &lt;sc-toggle-data sn-data="::item.description"&gt;&lt;/sc-toggle-data&gt;
                          &lt;/div&gt;
                        &lt;/div&gt;
                      &lt;/div&gt;
                      &lt;fieldset ng-class="{'disabled-mask': !item.included}"&gt;&lt;/fieldset&gt;
                      &lt;sp-cat-item item="item" /&gt;
                      &lt;sp-model form-model="item" mandatory="item._mandatory"&gt;&lt;/sp-model&gt;
                      &lt;div&gt;
                        &lt;div ng-if="item.attachments.length" class="file-list-wrap"&gt;
                          &lt;ul class="list-group" style="margin-bottom: 0; padding:0"&gt;
                            &lt;li class="list-group-item" ng-repeat="attachment in item.attachments"&gt;
                              &lt;div class="sp-attachment-block-single-line file-attachment row" id="{{::attachment.sys_id}}"&gt;
                                &lt;a aria-label="{{::(attachment.thumbSrc ? m.viewAttachedImage : m.downloadAttachment)}}" tabindex="0" class="col-md-1 col-sm-1 col-xs-2 view-attachment m-b-none text-center" style="border: none;"
                                   ng-click="item.attachmentHandler.viewAttachment($event, attachment)" href="javascript:void(0)" title="View" &gt;
                                  &lt;img alt="" ng-if="attachment.thumbSrc" class="attachment-thumbnail img-responsive" ng-src="{{attachment.thumbSrc}}"/&gt;
                                  &lt;span ng-if="::!attachment.thumbSrc"&gt;
                                    &lt;span class="glyphicon glyphicon-file text-2x"/&gt;
                                  &lt;/span&gt;
                                &lt;/a&gt;
                                &lt;div class="col-md-9 col-sm-8 col-xs-7 file-name v-middle"&gt;
                                  &lt;a tabindex="0" class="get-attachment" ng-click="item.attachmentHandler.downloadAttachment(attachment)" ng-attr-title="${Download} {{::attachment.file_name}}" href="javascript:void(0)"&gt;
                                    {{::attachment.file_name}} ({{::attachment.size}})
                                  &lt;/a&gt;
                                  &lt;input tabindex="-1" ng-keydown="item.attachmentHandler.onKeyDown($event, attachment)" ng-blur="item.attachmentHandler.updateAttachment($event, attachment)" style="display: none;"/&gt;
                                  &lt;div&gt;
                                    &lt;time&gt;&lt;sn-time-ago timestamp="::attachment.sys_updated_on" /&gt;&lt;/time&gt;
                                  &lt;/div&gt;
                                &lt;/div&gt;
                                &lt;div class="col-md-2 col-sm-3 col-xs-3 tools v-middle align-right"&gt;
                                  &lt;div class="btn-group" ng-if="::(attachment.canWrite || attachment.canDelete)"&gt;
                                    &lt;button type="button" tabindex="0" class="btn btn-default btn-clear" ng-click="item.attachmentHandler.editAttachment($event, attachment)" title="${Edit file name}" aria-label="${Edit file name}"&gt;&lt;i class="fa fa-pencil" aria-hidden="true"&gt;&lt;/i&gt;&lt;/button&gt;
                                    &lt;button type="button" tabindex="0" class="btn btn-default btn-clear" ng-click="item.confirmDeleteAttachment(attachment, $event)" title="${Delete}" aria-label="${Delete}"&gt;&lt;i class="fa fa-times" aria-hidden="true"&gt;&lt;/i&gt;&lt;/button&gt;
                                  &lt;/div&gt;
                                &lt;/div&gt;
                              &lt;/div&gt;
                            &lt;/li&gt;
                          &lt;/ul&gt;
                          &lt;div class="errors-wrap" ng-hide="errorMessages.length == 0"&gt;
                            &lt;div class="error-msg icon-cross" ng-repeat="error in errorMessages" ng-click="item.attachmentHandler.dismissMsg($event, $index, errorMessages)"&gt;
                              &lt;span&gt;{{error.msg}}&lt;/span&gt;
                              &lt;span class="file-name"&gt;{{error.fileName}}&lt;/span&gt;
                            &lt;/div&gt;
                          &lt;/div&gt;
                        &lt;/div&gt;
                        &lt;div ng-class="{'mobile-attachment-label' : {{::data.isMEE}} }"&gt;
                          &lt;label ng-if="!submitted &amp;&amp; !item.no_attachments" ng-class="{'attachment-label' : {{::!data.isMEE}} }"&gt;
                            &lt;span class="file-upload-input"&gt;
                              &lt;input type="file" style="display: none" multiple="true" ng-file-select="item.attachmentHandler.onFileSelect($files)" class="sp-attachments-input"/&gt;
                              &lt;button title="" ng-click="item.attachmentHandler.openSelector($event)" class="panel-button sp-attachment-add btn btn-link" aria-label="${Add attachment}"&gt;&lt;span class="glyphicon glyphicon-paperclip"&gt;&lt;/span&gt;&lt;/button&gt;
                            &lt;/span&gt;
                            &lt;span class="fa fa-asterisk mandatory" 
                                  ng-if="item.mandatory_attachment &amp;&amp; item.included" 
                                  ng-class="{'mandatory-filled': item.mandatory_attachment &amp;&amp; item.attachment_submitted}"
                                  style="vertical-align:super"&gt;&lt;/span&gt;
                            &lt;span class="add-attachment-content"&gt;${Add attachments}&lt;/span&gt;
                          &lt;/label&gt;
                        &lt;/div&gt;
                      &lt;/div&gt;
                      &lt;div ng-if="::data.isMEE" class="font-normal og-item-price"&gt;
                        &lt;strong class="" ng-if="data.showPrices &amp;&amp; item.price"&gt;{{item.price_display}}&lt;/strong&gt;
                        &lt;span class="" ng-if="data.showPrices &amp;&amp; item.recurring_price"&gt; + {{item.recurring_price_display}} {{item.recurring_price_frequency}}&lt;/span&gt;
                        &lt;label class="" ng-if="!data.hideDeliveryTime &amp;&amp; item.sys_class_name != 'sc_cat_item_producer' &amp;&amp; item.sys_class_name != 'sc_cat_item_guide' &amp;&amp; (!item.no_delivery_time &amp;&amp; item.estimated_delivery_time)"&gt;{{::item.estimated_delivery_time}} ${Delivery}&lt;/label&gt;
                      &lt;/div&gt;
										&lt;/div&gt;
									&lt;/div&gt;
								&lt;/div&gt;
              &lt;/uib-accordion-group&gt;
            &lt;/uib-accordion&gt;
						&lt;/div&gt;
					&lt;/div&gt;
					&lt;div class="empty-state-content" ng-if="includedItems.length == 0 &amp;&amp; !evaluatingIncludes"&gt;
            			&lt;h3&gt;${Order Guide has no items to order}&lt;/h3&gt;
          			&lt;/div&gt;
				&lt;/div&gt;
				&lt;div ng-if="guide_step == 2"&gt;
					&lt;div ng-class="::data.isMEE ? 'list-group-mobile' : 'list-group'"&gt;
            &lt;section ng-if="::data.isMEE" class="summary"&gt;
							&lt;label class="m-b-lg m-l-sm"&gt;${Order Guide Details}&lt;/label&gt;
							&lt;section ng-repeat="item in ::includedItems track by item.sys_id| orderBy: 'order'" ng-class="::['b-b' ,{'summary-excluded': !item.included}]"&gt;
                &lt;div class="wrapper-cart-xs guide-item"&gt;
                  &lt;label class="guide-item-quantity"&gt;{{::item.quantity}} &lt;/label&gt;
									&lt;div class="guide-item-name"&gt;
                    &lt;span class="wrap-word"&gt;{{::item.name}}&lt;/span&gt;
                    &lt;div&gt;
                      &lt;span&gt;{{::(data.showPrices &amp;&amp; item.price &amp;&amp; item.price_subtotal ? item.price_subtotal_display : '')}}&lt;/span&gt;
                      &lt;span&gt;{{::(data.showPrices &amp;&amp; item.recurring_price &amp;&amp; item.recurring_price_subtotal ? " +" + item.recurring_price_subtotal_display : '')}}&lt;/span&gt;
                      &lt;span ng-if="::(data.showPrices &amp;&amp; item.recurring_price &amp;&amp; item.recurring_price_frequency)" style="font-size:10px"&gt;{{::item.recurring_price_frequency}}&lt;/span&gt;
                    &lt;/div&gt;
                  &lt;/div&gt;
                &lt;/div&gt;
                &lt;label ng-if="::!item.included" class="wrapper-xs not-included not-included-pill"&gt;${NOT INCLUDED}&lt;/label&gt;
              &lt;/section&gt;
						&lt;/section&gt;
            
						&lt;table ng-if="::!data.isMEE" class="table table-striped m-b-sm light-border-bottom summary add-margin-bottom-xs" summary="${Summary of the guide}"&gt;
							&lt;thead&gt;
								&lt;tr&gt;
									&lt;th class="wrapper-sm wrapper-cart-xs col-md-5 col-lg-5 col-xs-8 col-sm-8 border-bottom-xs" scope="col"&gt;${Order Guide Details}&lt;/th&gt;
									&lt;th class="wrapper-sm col-md-1 col-lg-1 text-a-c hidden-xs hidden-sm" scope="col"&gt;${Quantity}&lt;/th&gt;
									&lt;th class="wrapper-sm col-md-2 col-lg-2 text-a-c hidden-xs hidden-sm" scope="col"&gt;${Price} (${ea.})&lt;/th&gt;
									&lt;th class="wrapper-sm col-md-2 col-lg-2 text-a-c hidden-xs hidden-sm" scope="col"&gt;${Recurring} (${ea.})&lt;/th&gt;
                  &lt;th class="wrapper-sm wrapper-cart-xs col-md-2 col-lg-2 col-xs-4 col-sm-4 border-bottom-xs" scope="col" ng-hide="totalIncluded == includedItems.length" style="width:12%"&gt;&lt;/th&gt;
								&lt;/tr&gt;
							&lt;/thead&gt;
							&lt;tbody&gt;
								&lt;tr ng-repeat="item in ::includedItems track by item.sys_id| orderBy: 'order'" ng-class="::{'summary-excluded': !item.included}"&gt;
									&lt;td class="wrapper-sm v-middle wrapper-cart-xs border-top-xs"&gt;
                    &lt;span class="hidden-md hidden-lg"&gt;{{::item.quantity}} &lt;/span&gt;
										&lt;span class="wrap-word"&gt;{{::item.name}}&lt;/span&gt;
									&lt;/td&gt;
									&lt;td class="wrapper-sm v-middle text-a-c hidden-xs hidden-sm"&gt;
										&lt;span&gt;{{::(!item.no_quantity? item.quantity : '---')}}&lt;/span&gt;
									&lt;/td&gt;
									&lt;td class="wrapper-sm v-middle text-a-c hidden-xs hidden-sm"&gt;
										&lt;span&gt;&lt;strong&gt;{{::(data.showPrices &amp;&amp; item.price &amp;&amp; item.price_subtotal ? item.price_subtotal_display : '---')}}&lt;/strong&gt;&lt;/span&gt;
									&lt;/td&gt;
									&lt;td class="wrapper-sm v-middle text-a-c hidden-xs hidden-sm"&gt;
										&lt;span class="clearfix"&gt;&lt;strong&gt;{{::(data.showPrices &amp;&amp; item.recurring_price &amp;&amp; item.recurring_price_subtotal ? item.recurring_price_subtotal_display : '---')}}&lt;/strong&gt;&lt;/span&gt;
										&lt;span ng-if="::(data.showPrices &amp;&amp; item.recurring_price &amp;&amp; item.recurring_price_frequency)" style="font-size:10px"&gt;{{::item.recurring_price_frequency}}&lt;/span&gt;
									&lt;/td&gt;
                  &lt;td class="wrapper-sm v-middle text-a-r wrapper-cart-xs border-top-xs" ng-hide="::(totalIncluded == includedItems.length)"&gt;
										&lt;span ng-if="::!item.included" class="wrapper-xs not-included not-included-pill"&gt;${NOT INCLUDED}&lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;            
            &lt;div class="padder-v clearfix hidden-xs hidden-sm hidden-md" ng-if="::!data.isMEE" style="padding-top: 25px !important"&gt;
              &lt;div  class="pull-right"&gt;
                &lt;button ng-disabled="submitted" name="add_to_cart" ng-click="triggerAddToCart()" class="btn btn-default m-r m-l m-r-6" ng-if="showAddToCart"&gt;${Add to Cart}&lt;/button&gt;
                &lt;button ng-disabled="submitted" name="prev" ng-click="goPrev()" class="btn btn-default m-r m-r-6"&gt;${Edit Options}&lt;/button&gt;
                &lt;button ng-disabled="submitted" name="order" ng-click="triggerSubmit()" class="btn btn-primary" sn-focus="guide_step == 2"&gt;{{::submitButtonMsg}}&lt;/button&gt;
              &lt;/div&gt;
						&lt;div class="pull-right m-r-lg m-l wrapper-sm" ng-if="data.showPrices" style="top: -10px;position: relative;"&gt;
								&lt;div class="pull-left"&gt;&lt;strong&gt;${Total} : &lt;/strong&gt;
								&lt;/div&gt;
								&lt;div class="pull-left m-l-xs"&gt;
									&lt;div&gt;&lt;strong&gt; {{price_display}}&lt;/strong&gt;
									&lt;/div&gt;
									&lt;div ng-repeat="freq in ::frequencySequence"&gt;
										&lt;span class="clearfix" ng-if="frequencyMap.hasOwnProperty(freq)" style="font-size:13px"&gt; + {{(frequencyMap[freq] + ' ' + freq)}}&lt;/span&gt;
									&lt;/div&gt;
								&lt;/div&gt;
							&lt;/div&gt;
						&lt;/div&gt;
            
            &lt;div class="clearfix visible-xs visible-sm visible-md"&gt;
              &lt;div class="m-r-lg m-b-sm" ng-class="'{{::data.isMEE ? 'pull-right m-t-sm' : 'pull-left'}}'" ng-if="::data.showPrices"&gt;
								&lt;div class="pull-left"&gt;&lt;strong&gt;${Total : }&lt;/strong&gt;
								&lt;/div&gt;
								&lt;div class="pull-left m-l-xs"&gt;
									&lt;div&gt;&lt;strong&gt; {{price_display}}&lt;/strong&gt;
									&lt;div ng-repeat="freq in ::frequencySequence"&gt;
										&lt;span class="clearfix" ng-if="frequencyMap.hasOwnProperty(freq)" style="font-size:13px"&gt; + {{(frequencyMap[freq] + ' ' + freq)}}&lt;/span&gt;
									&lt;/div&gt;
									&lt;/div&gt;
								&lt;/div&gt;
							&lt;/div&gt;
            	&lt;button ng-disabled="submitted" name="add_to_cart" ng-click="triggerAddToCart()" class="btn btn-default m-b-sm col-xs-12" ng-if="::!data.isMEE &amp;&amp; showAddToCart"&gt;
                  ${Add to Cart}&lt;/button&gt;
              &lt;button ng-if="::!data.isMEE"  ng-disabled="submitted" name="prev" ng-click="goPrev()" class="btn btn-default m-b-sm col-xs-12"&gt;
                  ${Edit Options}&lt;/button&gt;
              &lt;button ng-if="::!data.isMEE" ng-disabled="submitted" name="order" ng-click="triggerSubmit()" class="btn btn-primary col-xs-12" sn-focus="guide_step == 2"&gt;
                  {{::submitButtonMsg}}&lt;/button&gt;
            &lt;/div&gt;
            
					&lt;/div&gt;
				&lt;/div&gt;
				&lt;div ng-if="::!data.isMEE &amp;&amp; !data.readonly_user" class="guide-nav" ng-hide="evaluatingIncludes || guide_step == 2" ng-class="{'guide-nav-setp1': guide_step == 1}"&gt;
          &lt;div class="pull-right"&gt;
            &lt;button ng-hide="guide_step != 1 || submitted" name="submit" ng-click="goPrev()" class="btn btn-default padder pull-left-xs" ng-class="{'m-r-6': guide_step &lt; 2}"&gt;{{::m.prevMsg}}&lt;/button&gt;
            &lt;button id="submit" ng-hide="guide_step &gt; 1" ng-disabled="submitted || data.sc_cat_item._mandatory.length &gt; 0 || (totalIncluded &lt;= 0 &amp;&amp; guide_step != 0)" name="submit" ng-click="goNext()" class="btn btn-primary padder-lg" sn-focus="guide_step &lt; 2"&gt;{{::m.nextMsg}}&lt;/button&gt;
            &lt;span ng-if="validating" style="padding-left:4px"&gt;${Validating...}&lt;/span&gt;
          &lt;/div&gt;
				&lt;/div&gt;
			&lt;/div&gt;
		&lt;/div&gt;
	&lt;/div&gt;
	&lt;div ng-if="::!data.sc_cat_item"&gt;
		&lt;div class="panel panel-default"&gt;
			&lt;div class="panel-heading"&gt;
				&lt;h4 class="panel-title"&gt;${Item not found}&lt;/h4&gt;
			&lt;/div&gt;
			&lt;div class="panel-body wrapper"&gt;
				&lt;p&gt;${This item is not found or currently not available}&lt;/p&gt;
				&lt;p&gt;${Suggestions}:&lt;/p&gt;
				&lt;ul&gt;
					&lt;li&gt;${Try searching for the item}&lt;/li&gt;
					&lt;li&gt;${Go to the Service Catalog homepage}&lt;/li&gt;
				&lt;/ul&gt;
			&lt;/div&gt;
		&lt;/div&gt;
	&lt;/div&gt;
&lt;/div&gt;
&lt;div ng-if="::!data.recordFound" class="alert alert-info"&gt;{{::m.invalidRecordMsg}}&lt;/div&gt;
&lt;now-message key="Items have been added successfully" value="${Items have been added successfully}"/&gt;
&lt;now-message key="Items have been added successfully to your cart" value="${Items have been added successfully to your cart}"/&gt;
&lt;now-message key="Add to Cart" value="${Add to Cart}"/&gt;
&lt;now-message key="Catalog Home" value="${Catalog Home}"/&gt;
&lt;now-message key="View Cart" value="${View Cart}"/&gt;
&lt;now-message key="Attachment(s) are not added" value="${Attachment(s) are not added}"/&gt;
&lt;now-message key="Please wait, attachment deletion in progress" value="${Please wait, attachment deletion in progress}"/&gt;
&lt;now-message key="Leave page?" value="${Leave page?}"/&gt;
&lt;now-message key="Changes you made will be lost." value="${Changes you made will be lost.}"/&gt;
&lt;now-message key="Cancel" value="${Cancel}"/&gt;
&lt;now-message key="Leave" value="${Leave}"/&gt;
&lt;now-message key="Done" value="${Done}"/&gt;

&lt;script type="text/ng-template" id="group-template.html"&gt;
   &lt;div&gt;
    &lt;div class="panel-heading"&gt;
      &lt;div class="panel-title"&gt;
        &lt;div tabindex="0" class="accordion-toggle" ng-click="toggleOpen()" uib-accordion-transclude="heading" role="none"&gt;
          &lt;span uib-accordion-header&gt;
          &lt;/span&gt;
        &lt;/div&gt;
  		&lt;/div&gt;
  	&lt;/div&gt;
    &lt;div class="panel-collapse collapse" uib-collapse="!isOpen"&gt;
      &lt;div ng-transclude&gt;&lt;/div&gt;
  	&lt;/div&gt;
  &lt;/div&gt;
  &lt;/script&gt;]]&gt;&lt;/template&gt;&lt;/sp_widget&gt;&lt;/record_update&gt;</payload>
        <payload_hash>-1274449163</payload_hash>
        <record_name>GService SC Order Guide</record_name>
        <reverted_from/>
        <source>71dc5d0cdb51dc905c116390149619b7</source>
        <source_table>sys_update_set</source_table>
        <state>previous</state>
        <sys_created_by>organize.fernando</sys_created_by>
        <sys_created_on>2020-06-04 18:17:40</sys_created_on>
        <sys_id>e27b290cdb19d450fa11cf2414961929</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_recorded_at>172808d8f340000001</sys_recorded_at>
        <sys_updated_by>organize.fernando</sys_updated_by>
        <sys_updated_on>2020-06-04 18:17:40</sys_updated_on>
        <type>Widget</type>
        <update_guid>9a7b290c2819d4506d3101199976b628</update_guid>
        <update_guid_history>9a7b290c2819d4506d3101199976b628:-1274449163,465ba50cee19d45067dfac7591cc5f1d:-156798796,38ea650c3719d450df4f8a55daffc7cb:-1274449163</update_guid_history>
    </sys_update_version>
    <sys_metadata_delete action="INSERT_OR_UPDATE">
        <sys_audit_delete display_value="">46cb654cdb19d450fa11cf24149619f0</sys_audit_delete>
        <sys_class_name>sys_metadata_delete</sys_class_name>
        <sys_created_by>organize.fernando</sys_created_by>
        <sys_created_on>2020-06-04 18:19:01</sys_created_on>
        <sys_db_object display_value="" name="sp_widget">sp_widget</sys_db_object>
        <sys_id>7c5e8edce1464d92913f504e5b507171</sys_id>
        <sys_metadata>bcea650cdb19d450fa11cf24149619c8</sys_metadata>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>GService SC Order Guide</sys_name>
        <sys_package display_value="ITSM Service Portal" source="x_gmeps_itsm_servi">334ae627dbc85c105c1163901496192f</sys_package>
        <sys_parent/>
        <sys_policy/>
        <sys_scope display_value="ITSM Service Portal">334ae627dbc85c105c1163901496192f</sys_scope>
        <sys_scope_delete display_value="">0df1a4379dc4442b9d37a43c61c804b1</sys_scope_delete>
        <sys_update_name>sp_widget_bcea650cdb19d450fa11cf24149619c8</sys_update_name>
        <sys_update_version display_value="sp_widget_bcea650cdb19d450fa11cf24149619c8">e27b290cdb19d450fa11cf2414961929</sys_update_version>
        <sys_updated_by>organize.fernando</sys_updated_by>
        <sys_updated_on>2020-06-04 18:19:01</sys_updated_on>
    </sys_metadata_delete>
</record_update>
